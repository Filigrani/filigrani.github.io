function k(a,b,c,d){a.B.lc(a.pc,b,c,d)}function aa(a,b,c){return a.B.Cf(a.pc,b,c)}function ba(a,b,c,d){a.B.Ca?k(a,b,c,d):a.B.qh()._OnMessageFromDOM({type:"event",component:a.pc,handler:b,dispatchOpts:d||null,data:c,responseId:null})}function n(a,b,c){a.B.K(a.pc,b,c)}function ca(a,b){for(const [c,d]of b)n(a,c,d)}function da(a){a.nd||(a.B.Df(a.sg),a.nd=!0)}window.qb=class{constructor(a,b){this.B=a;this.pc=b;this.nd=!1;this.sg=()=>this.fa()}rf(){}fa(){}};
window.ei=class{constructor(){this.jf=-1}o(){-1!==this.jf&&(self.clearTimeout(this.jf),this.jf=-1)}};"use strict";class ea{constructor(a){this.Ae=a;this.Fe=!1;this.Re=!0}}function fa(a,b){const c=b.elementId,d=a.Ud(c,b),e=new ea(d);a.tc.set(c,e);d.style.boxSizing="border-box";d.style.display="none";e.Re=!!b.isVisible;d.addEventListener("focus",()=>{ha(a,"elem-focused",c)});d.addEventListener("blur",()=>{ha(a,"elem-blurred",c)});a.dd&&document.body.appendChild(d)}
function p(a,b,c){n(a,b,d=>{const e=r(a,d.elementId);return c(e,d)})}function r(a,b){a=a.tc.get(b);if(!a)throw Error(`no element with id ${b}`);return a.Ae}function ha(a,b,c,d){d||(d={});d.elementId=c;k(a,b,d)}function ka(a,b,c,d){d||(d={});d.elementId=c;ba(a,b,d)}
window.vf=class extends self.qb{constructor(a,b){super(a,b);this.tc=new Map;this.dd=!0;ca(this,[["create",c=>fa(this,c)],["destroy",c=>{c=c.elementId;const d=r(this,c);this.dd&&d.parentElement.removeChild(d);this.tc.delete(c)}],["set-visible",c=>{if(this.dd){var d=this.tc.get(c.elementId),e=d.Ae;d.Fe?e.style.display=c.isVisible?"":"none":d.Re=!!c.isVisible}}],["update-position",c=>{if(this.dd){var d=this.tc.get(c.elementId),e=d.Ae;e.style.left=c.left+"px";e.style.top=c.top+"px";e.style.width=c.width+
"px";e.style.height=c.height+"px";c=c.fontSize;null!==c&&(e.style.fontSize=c+"em");d.Fe||(d.Fe=!0,d.Re&&(e.style.display=""))}}],["update-state",c=>{const d=r(this,c.elementId);this.mc(d,c)}],["focus",c=>this.qe(c)],["set-css-style",c=>{const d=r(this,c.elementId),e=c.prop;c=c.val;e.startsWith("--")?d.style.setProperty(e,c):d.style[e]=c}],["set-attribute",c=>{r(this,c.elementId).setAttribute(c.name,c.val)}],["remove-attribute",c=>{r(this,c.elementId).removeAttribute(c.name)}]]);p(this,"get-element",
c=>c)}Ud(){throw Error("required override");}mc(){throw Error("required override");}qe(a){var b=r(this,a.elementId);a.focus?b.focus():b.blur()}};"use strict";const la=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),ma=/android/i.test(navigator.userAgent),na=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/|nwjs)/i.test(navigator.userAgent);let oa=0;
function pa(a){const b=document.createElement("script");b.async=!1;b.type="module";return a.Vh?new Promise(c=>{const d="c3_resolve_"+oa;++oa;self[d]=c;b.textContent=a.Zh+`\n\nself["${d}"]();`;document.head.appendChild(b)}):new Promise((c,d)=>{b.onload=c;b.onerror=d;b.src=a;document.head.appendChild(b)})}let qa=!1,ra=!1;function sa(){if(!qa){try{new Worker("blob://",{get type(){ra=!0}})}catch(a){}qa=!0}return ra}let z=new Audio;
const ta={"audio/webm; codecs=opus":!!z.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!z.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!z.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!z.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!z.canPlayType("audio/mp4"),"audio/mpeg":!!z.canPlayType("audio/mpeg")};z=null;async function va(a){a=await wa(a);return(new TextDecoder("utf-8")).decode(a)}
function wa(a){return new Promise((b,c)=>{const d=new FileReader;d.onload=e=>b(e.target.result);d.onerror=e=>c(e);d.readAsArrayBuffer(a)})}const xa=[];let ya=0;window.RealFile=window.File;const za=[],Aa=new Map,Ba=new Map;let Ca=0;const Da=[];self.runOnStartup=function(a){if("function"!==typeof a)throw Error("runOnStartup called without a function");Da.push(a)};const Fa=new Set(["cordova","playable-ad","instant-games"]);let Ga=!1;
window.Ea=class a{constructor(b){this.Ca=b.ai;this.mb=null;this.Ba="";this.$b=b.Yh;this.Tc={};this.Rb=this.gb=null;this.jd=[];this.V=this.Wa=null;this.Ne=!1;this.Uf=0;this.Bc=null;this.Yb=-1;this.Nh=()=>this.yh();this.Xb=[];this.kf=null;this.tg=[];this.G=b.ug;this.od="file"===location.protocol.substr(0,4);!this.Ca||"undefined"!==typeof OffscreenCanvas&&navigator.userActivation&&sa()||(this.Ca=!1);this.Ca&&na&&(this.Ca=!1);if("playable-ad"===this.G||"instant-games"===this.G)this.Ca=!1;if("cordova"===
this.G&&this.Ca)if(ma){const c=/Chrome\/(\d+)/i.exec(navigator.userAgent);c&&90<=parseInt(c[1],10)||(this.Ca=!1)}else this.Ca=!1;this.jb()?self.chrome.webview.addEventListener("message",c=>this.If(c.data)):"macos-wkwebview"===this.G&&(self.C3WrapperOnMessage=c=>this.If(c));this.ud=this.ab=null;"html5"!==this.G||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available.");
this.K("runtime","cordova-fetch-local-file",c=>this.uh(c));this.K("runtime","create-job-worker",()=>this.vh());this.K("runtime","send-wrapper-extension-message",c=>this.Bh(c));"cordova"===this.G?document.addEventListener("deviceready",()=>this.Gf(b)):this.Gf(b)}o(){this.he();this.mb&&(this.mb=this.mb.onmessage=null);this.gb&&(this.gb.terminate(),this.gb=null);this.Rb&&(this.Rb.o(),this.Rb=null);this.V&&(this.V.parentElement.removeChild(this.V),this.V=null)}fh(){return la&&"cordova"===this.G}ae(){const b=
navigator.userAgent;return la&&Fa.has(this.G)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(b)}dh(){return ma}zf(){return ma&&Fa.has(this.G)}jb(){return"windows-webview2"===this.G||!!("preview"===this.G&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}async Gf(b){"macos-wkwebview"===this.G?this.ub({type:"ready"}):this.jb()&&(this.Eh(),this.tg=(await this.th()).registeredComponentIds);if("playable-ad"===this.G){this.ab=self.c3_base64files;this.ud={};await this.mh();
for(let d=0,e=b.dc.length;d<e;++d){var c=b.dc[d];this.ud.hasOwnProperty(c)?b.dc[d]={Vh:!0,Zh:this.ud[c]}:this.ab.hasOwnProperty(c)&&(b.dc[d]=URL.createObjectURL(this.ab[c]))}b.Qd=[]}if("nwjs"===this.G&&self.nw&&self.nw.App.manifest["c3-steam-mode"]){let d=0;this.Df(()=>{d++;document.body.style.opacity=0===d%2?"1":"0.999"})}b.Xh?this.Ba=b.Xh:(c=location.origin,this.Ba=("null"===c?"file:///":c)+location.pathname,c=this.Ba.lastIndexOf("/"),-1!==c&&(this.Ba=this.Ba.substr(0,c+1)));b.ci&&(this.Tc=b.ci);
c=new MessageChannel;this.mb=c.port1;this.mb.onmessage=d=>this._OnMessageFromRuntime(d.data);window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(d=>this.xh(d));this.Bc=new self.gh(this);await Ha(this.Bc);"object"===typeof window.StatusBar&&window.StatusBar.hide();if("object"===typeof window.AndroidFullScreen)try{await new Promise((d,e)=>{window.AndroidFullScreen.immersiveMode(d,e)})}catch(d){console.error("Failed to enter Android immersive mode: ",d)}this.Ca?await this.sh(b,c.port2):
await this.rh(b,c.port2)}je(b){b=this.Tc.hasOwnProperty(b)?this.Tc[b]:b.endsWith("/workermain.js")&&this.Tc.hasOwnProperty("workermain.js")?this.Tc["workermain.js"]:"playable-ad"===this.G&&this.ab.hasOwnProperty(b)?this.ab[b]:b;b instanceof Blob&&(b=URL.createObjectURL(b));return b}async Vd(b,c,d){if(b.startsWith("blob:"))return new Worker(b,d);if("cordova"===this.G&&this.od)return b=await this.Vc(d.Uh?b:this.$b+b),new Worker(URL.createObjectURL(new Blob([b],{type:"application/javascript"})),d);b=
new URL(b,c);if(location.origin!==b.origin){b=await fetch(b);if(!b.ok)throw Error("failed to fetch worker script");b=await b.blob();return new Worker(URL.createObjectURL(b),d)}return new Worker(b,d)}Ya(){return Math.max(window.innerWidth,1)}Oa(){return Math.max(window.innerHeight,1)}Ff(b){var c=this.Ba,d=location.href,e=this.Ya(),f=this.Oa(),g=window.devicePixelRatio,h=a.jc(),l=b.ii,v=window.cr_previewImageBlobs||this.ab,q=window.cr_previewProjectFileBlobs,D=window.cr_previewProjectFiles,y=window.cr_swClientId||
"";b=b.ug;var t=(new URLSearchParams(self.location.search)).has("debug"),u=this.Bc;return{runtimeBaseUrl:c,previewUrl:d,windowInnerWidth:e,windowInnerHeight:f,devicePixelRatio:g,isFullscreen:h,projectData:l,previewImageBlobs:v,previewProjectFileBlobs:q,previewProjectFileSWUrls:D,swClientId:y,exportType:b,isDebug:t,ife:!!self.hi,jobScheduler:{inputPort:u.Le,outputPort:u.$e,maxNumWorkers:u.Ih},supportedAudioFormats:ta,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this.$b+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||
this.$b+"opus.wasm.wasm",isFileProtocol:this.od,isiOSCordova:this.fh(),isiOSWebView:this.ae(),isWebView2Wrapper:this.jb(),wrapperComponentIds:this.tg,isFBInstantAvailable:"undefined"!==typeof self.FBInstant}}async sh(b,c){const d=this.je(b.bi);"preview"===this.G?(this.gb=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((h,l)=>{const v=q=>{this.gb.removeEventListener("message",v);q.data&&"ok"===q.data.type?h():l()};this.gb.addEventListener("message",v);this.gb.postMessage({type:"construct-worker-init",
"import":(new URL(d,this.Ba)).toString()})})):this.gb=await this.Vd(d,this.Ba,{type:"module",name:"Runtime",Uh:!0});this.V=document.createElement("canvas");this.V.style.display="none";const e=this.V.transferControlToOffscreen();document.body.appendChild(this.V);window.c3canvas=this.V;self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders();let f=b.Qd||[],g=b.dc;f=await Promise.all(f.map(h=>this.Lb(h)));g=await Promise.all(g.map(h=>this.Lb(h)));if("cordova"===this.G)for(let h=0,l=b.Pd.length;h<
l;++h){const v=b.Pd[h],q=v[0];if(q===b.nf||"scriptsInEvents.js"===q||q.endsWith("/scriptsInEvents.js"))v[1]=await this.Lb(q)}this.gb.postMessage(Object.assign(this.Ff(b),{type:"init-runtime",isInWorker:!0,messagePort:c,canvas:e,workerDependencyScripts:f,engineScripts:g,projectScripts:b.Pd,mainProjectScript:b.nf,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[c,e,...Ia(this.Bc)]);this.jd=za.map(h=>new h(this));this.Ef();Ja(this.Wa);self.c3_callFunction=(h,l)=>aa(this.Wa,"js-invoke-function",{name:h,
params:l});"preview"===this.G&&(self.goToLastErrorScript=()=>this.lc("runtime","go-to-last-error-script"))}async rh(b,c){this.V=document.createElement("canvas");this.V.style.display="none";document.body.appendChild(this.V);window.c3canvas=this.V;self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders();this.jd=za.map(g=>new g(this));this.Ef();var d=b.dc.map(g=>"string"===typeof g?(new URL(g,this.Ba)).toString():g);if(Array.isArray(b.Qd)){var e=[...b.Qd].map(g=>g instanceof Blob?URL.createObjectURL(g):
g);d.unshift(...e)}d=await Promise.all(d.map(g=>this.Lb(g)));await Promise.all(d.map(g=>pa(g)));d=self.C3_ProjectScriptsStatus;e=b.nf;const f=b.Pd;for(let [g,h]of f)if(h||(h=g),g===e)try{h=await this.Lb(h),await pa(h),"preview"!==this.G||d[g]||this.Jf(g,"main script did not run to completion")}catch(l){this.Jf(g,l)}else if("scriptsInEvents.js"===g||g.endsWith("/scriptsInEvents.js"))h=await this.Lb(h),await pa(h);"preview"===this.G&&"object"!==typeof self.di.fi?(this.$c(),console.error("[C3 runtime] Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax."),
alert("Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.")):(b=Object.assign(this.Ff(b),{isInWorker:!1,messagePort:c,canvas:this.V,runOnStartupFunctions:Da}),Ja(this.Wa),this.Hf(),this.Rb=self.C3_CreateRuntime(b),await self.C3_InitRuntime(this.Rb,b))}Jf(b,c){this.$c();console.error(`[Preview] Failed to load project main script (${b}): `,c);alert(`Failed to load project main script (${b}). Check all your JavaScript code has valid syntax. Press F12 and check the console for error details.`)}Hf(){this.$c()}$c(){const b=
window.cr_previewLoadingElem;b&&(b.parentElement.removeChild(b),window.cr_previewLoadingElem=null)}async vh(){const b=await Ka(this.Bc);return{outputPort:b,transferables:[b]}}qh(){if(this.Ca)throw Error("not available in worker mode");return this.Rb}lc(b,c,d,e,f){this.mb.postMessage({type:"event",component:b,handler:c,dispatchOpts:e||null,data:d,responseId:null},f)}Cf(b,c,d,e,f){const g=Ca++,h=new Promise((l,v)=>{Ba.set(g,{resolve:l,reject:v})});this.mb.postMessage({type:"event",component:b,handler:c,
dispatchOpts:e||null,data:d,responseId:g},f);return h}_OnMessageFromRuntime(b){const c=b.type;if("event"===c)return this.wh(b);if("result"===c)this.zh(b);else if("runtime-ready"===c)this.Ah();else if("alert-error"===c)this.$c(),alert(b.message);else if("creating-runtime"===c)this.Hf();else throw Error(`unknown message '${c}'`);}wh(b){const c=b.component,d=b.handler,e=b.data,f=b.responseId;if(b=Aa.get(c))if(b=b.get(d)){var g=null;try{g=b(e)}catch(h){console.error(`Exception in '${c}' handler '${d}':`,
h);null!==f&&this.Zc(f,!1,""+h);return}if(null===f)return g;g&&g.then?g.then(h=>this.Zc(f,!0,h)).catch(h=>{console.error(`Rejection from '${c}' handler '${d}':`,h);this.Zc(f,!1,""+h)}):this.Zc(f,!0,g)}else console.warn(`[DOM] No handler '${d}' for component '${c}'`);else console.warn(`[DOM] No event handlers for component '${c}'`)}Zc(b,c,d){let e;d&&d.transferables&&(e=d.transferables);this.mb.postMessage({type:"result",responseId:b,isOk:c,result:d},e)}zh(b){const c=b.responseId,d=b.isOk;b=b.result;
const e=Ba.get(c);d?e.resolve(b):e.reject(b);Ba.delete(c)}K(b,c,d){let e=Aa.get(b);e||(e=new Map,Aa.set(b,e));if(e.has(c))throw Error(`[DOM] Component '${b}' already has handler '${c}'`);e.set(c,d)}static hb(b){if(za.includes(b))throw Error("DOM handler already added");za.push(b)}Ef(){for(const b of this.jd)if("runtime"===b.pc){this.Wa=b;return}throw Error("cannot find runtime DOM handler");}xh(b){this.lc("debugger","message",b)}Ah(){for(const b of this.jd)b.rf()}static jc(){return!!(document.fullscreenElement||
document.webkitFullscreenElement||document.mozFullScreenElement||Ga)}static ad(b){Ga=!!b}Df(b){this.Xb.push(b);this.se()}Dh(b){b=this.Xb.indexOf(b);if(-1===b)throw Error("invalid callback");this.Xb.splice(b,1);this.Xb.length||this.he()}se(){-1===this.Yb&&this.Xb.length&&(this.Yb=requestAnimationFrame(this.Nh))}he(){-1!==this.Yb&&(cancelAnimationFrame(this.Yb),this.Yb=-1)}yh(){this.Yb=-1;for(const b of this.Xb)b();this.se()}tb(b){this.Wa.tb(b)}Kb(b){this.Wa.Kb(b)}re(){this.Wa.re()}Yc(b){this.Wa.Yc(b)}eh(){return!!ta["audio/webm; codecs=opus"]}async Fh(b){b=
await this.Cf("runtime","opus-decode",{arrayBuffer:b},null,[b]);return new Float32Array(b)}ih(b){this.Ne=!0;this.Uf=b}bh(b){return/^(?:[a-z\-]+:)?\/\//.test(b)||"data:"===b.substr(0,5)||"blob:"===b.substr(0,5)}Af(b){return!this.bh(b)}async Lb(b){return"cordova"===this.G&&(b.startsWith("file:")||this.od&&this.Af(b))?(b.startsWith(this.Ba)&&(b=b.substr(this.Ba.length)),b=await this.Vc(b),URL.createObjectURL(new Blob([b],{type:"application/javascript"}))):b}async uh(b){const c=b.filename;switch(b.as){case "text":return await this.$g(c);
case "buffer":return await this.Vc(c);default:throw Error("unsupported type");}}uf(b){const c=window.cordova.file.applicationDirectory+"www/"+b;return new Promise((d,e)=>{window.resolveLocalFileSystemURL(c,f=>{f.file(d,e)},e)})}async $g(b){b=await this.uf(b);return await va(b)}ie(){if(xa.length&&!(8<=ya)){ya++;var b=xa.shift();this.nh(b.filename,b.$h,b.Sh)}}Vc(b){return new Promise((c,d)=>{xa.push({filename:b,$h:e=>{ya--;this.ie();c(e)},Sh:e=>{ya--;this.ie();d(e)}});this.ie()})}async nh(b,c,d){try{const e=
await this.uf(b),f=await wa(e);c(f)}catch(e){d(e)}}If(b){if("entered-fullscreen"===b)a.ad(!0),La(this.Wa);else if("exited-fullscreen"===b)a.ad(!1),La(this.Wa);else if("object"===typeof b){const c=b.type;"wrapper-init-response"===c?(this.kf(b),this.kf=null):"extension-message"===c?this.lc("runtime","wrapper-extension-message",b):console.warn("Unknown wrapper message: ",b)}else console.warn("Unknown wrapper message: ",b)}Bh(b){this.ub({type:"extension-message",componentId:b.componentId,messageId:b.messageId,
params:b.params||[],asyncId:b.asyncId})}ub(b){this.jb()?window.chrome.webview.postMessage(JSON.stringify(b)):"macos-wkwebview"===this.G&&window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(b))}Eh(){window.moveTo=(b,c)=>{this.ub({type:"set-window-position",windowX:Math.ceil(b),windowY:Math.ceil(c)})};window.resizeTo=(b,c)=>{this.ub({type:"set-window-size",windowWidth:Math.ceil(b),windowHeight:Math.ceil(c)})}}th(){return this.jb()?new Promise(b=>{this.kf=b;this.ub({type:"wrapper-init"})}):
Promise.resolve()}async mh(){const b=[];for(const [c,d]of Object.entries(this.ab))b.push(this.lh(c,d));await Promise.all(b)}async lh(b,c){if("object"===typeof c)this.ab[b]=new Blob([c.str],{type:c.type}),this.ud[b]=c.str;else{let d=await this.ph(c);d||(d=this.oh(c));this.ab[b]=d}}async ph(b){try{return await (await fetch(b)).blob()}catch(c){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",
c),null}}oh(b){b=this.Ch(b);return this.kh(b.data,b.Wh)}Ch(b){var c=b.indexOf(",");if(0>c)throw new URIError("expected comma in data: uri");var d=b.substring(c+1);c=b.substring(5,c).split(";");b=c[0]||"";const e=c[2];d="base64"===c[1]||"base64"===e?atob(d):decodeURIComponent(d);return{Wh:b,data:d}}kh(b,c){var d=b.length;let e=d>>2,f=new Uint8Array(d),g=new Uint32Array(f.buffer,0,e),h,l;for(l=h=0;h<e;++h)g[h]=b.charCodeAt(l++)|b.charCodeAt(l++)<<8|b.charCodeAt(l++)<<16|b.charCodeAt(l++)<<24;for(d&=
3;d--;)f[l]=b.charCodeAt(l),++l;return new Blob([f],{type:c})}};"use strict";const Ma=self.Ea;function Na(a){return a.sourceCapabilities&&a.sourceCapabilities.firesTouchEvents||a.originalEvent&&a.originalEvent.sourceCapabilities&&a.originalEvent.sourceCapabilities.firesTouchEvents}const Oa=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),B={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},Pa={dispatchUserScriptEvent:!0},Qa={dispatchRuntimeEvent:!0};
function Ra(a){return new Promise((b,c)=>{const d=document.createElement("link");d.onload=()=>b(d);d.onerror=e=>c(e);d.rel="stylesheet";d.href=a;document.head.appendChild(d)})}function Sa(a){return new Promise((b,c)=>{const d=new Image;d.onload=()=>b(d);d.onerror=e=>c(e);d.src=a})}async function Ta(a){a=URL.createObjectURL(a);try{return await Sa(a)}finally{URL.revokeObjectURL(a)}}
function Ua(a){return new Promise((b,c)=>{let d=new FileReader;d.onload=e=>b(e.target.result);d.onerror=e=>c(e);d.readAsText(a)})}
async function Va(a,b,c){if(!/firefox/i.test(navigator.userAgent))return await Ta(a);var d=await Ua(a);d=(new DOMParser).parseFromString(d,"image/svg+xml");const e=d.documentElement;if(e.hasAttribute("width")&&e.hasAttribute("height")){const f=e.getAttribute("width"),g=e.getAttribute("height");if(!f.includes("%")&&!g.includes("%"))return await Ta(a)}e.setAttribute("width",b+"px");e.setAttribute("height",c+"px");d=(new XMLSerializer).serializeToString(d);a=new Blob([d],{type:"image/svg+xml"});return await Ta(a)}
function Wa(a){do{if(a.parentNode&&a.hasAttribute("contenteditable"))return!0;a=a.parentNode}while(a);return!1}const Xa=new Set(["input","textarea","datalist","select"]),Ya=new Set(["canvas","body","html"]);function H(a){a.target.tagName&&Ya.has(a.target.tagName.toLowerCase())&&a.preventDefault()}function Za(a){(a.metaKey||a.ctrlKey)&&a.preventDefault()}
self.C3_GetSvgImageSize=async function(a){a=await Ta(a);if(0<a.width&&0<a.height)return[a.width,a.height];a.style.position="absolute";a.style.left="0px";a.style.top="0px";a.style.visibility="hidden";document.body.appendChild(a);const b=a.getBoundingClientRect();document.body.removeChild(a);return[b.width,b.height]};self.C3_RasterSvgImageBlob=async function(a,b,c,d,e){a=await Va(a,b,c);const f=document.createElement("canvas");f.width=d;f.height=e;f.getContext("2d").drawImage(a,0,0,b,c);return f};
let $a=!1;document.addEventListener("pause",()=>$a=!0);document.addEventListener("resume",()=>$a=!1);function Ja(a){a.Tf=!0;a.Ve=a.B.Ya();a.Cc=a.B.Oa()}function La(a){if(!a.wa){var b=Ma.jc();b&&"any"!==a.gf&&ab(a);k(a,"fullscreenchange",{isFullscreen:b,innerWidth:a.Ya(),innerHeight:a.Oa()})}}async function bb(a){await Promise.all(a.webfonts.map(async b=>{b=new FontFace(b.name,`url('${b.url}')`);document.fonts.add(b);await b.load()}))}
async function cb(a){var b=a.imageBitmapOpts;a=await self.C3_RasterSvgImageBlob(a.blob,a.imageWidth,a.imageHeight,a.surfaceWidth,a.surfaceHeight);b=b?await createImageBitmap(a,b):await createImageBitmap(a);return{imageBitmap:b,transferables:[b]}}async function db(a){return await self.C3_GetSvgImageSize(a.blob)}function eb(a){window.c3_postToMessagePort&&(a.from="runtime",window.c3_postToMessagePort(a))}
function fb(a){self.setTimeout(()=>{a.Sf=!0},1E3);"cordova"===a.B.G?(document.addEventListener("pause",()=>gb(a,!0)),document.addEventListener("resume",()=>gb(a,!1))):document.addEventListener("visibilitychange",()=>gb(a,"hidden"===document.visibilityState));a.yd=!("hidden"!==document.visibilityState&&!$a);return{isSuspended:a.yd}}
function hb(a){a.Lf||(a.Lf=!0,window.addEventListener("deviceorientation",b=>{a.wa||k(a,"deviceorientation",{absolute:!!b.absolute,alpha:b.alpha||0,beta:b.beta||0,gamma:b.gamma||0,timeStamp:b.timeStamp,webkitCompassHeading:b.webkitCompassHeading,webkitCompassAccuracy:b.webkitCompassAccuracy},B)}),window.addEventListener("deviceorientationabsolute",b=>{a.wa||k(a,"deviceorientationabsolute",{absolute:!!b.absolute,alpha:b.alpha||0,beta:b.beta||0,gamma:b.gamma||0,timeStamp:b.timeStamp},B)}))}
function ib(a){a.Kf||(a.Kf=!0,window.addEventListener("devicemotion",b=>{if(!a.wa){var c=null,d=b.acceleration;d&&(c={x:d.x||0,y:d.y||0,z:d.z||0});d=null;var e=b.accelerationIncludingGravity;e&&(d={x:e.x||0,y:e.y||0,z:e.z||0});e=null;var f=b.rotationRate;f&&(e={alpha:f.alpha||0,beta:f.beta||0,gamma:f.gamma||0});k(a,"devicemotion",{acceleration:c,accelerationIncludingGravity:d,rotationRate:e,interval:b.interval,timeStamp:b.timeStamp},B)}}))}async function jb(a){await Ra(a.url)}
function kb(a,b){a.Vf=b.message;-1===a.Be&&(a.Be=setTimeout(()=>{a.Be=-1;const c=document.getElementById("exportToVideoMessage");c&&(c.textContent=a.Vf)},250))}function lb(a,b){console.warn("[Construct] Fullscreen request failed: ",b);k(a,"fullscreenerror",{isFullscreen:Ma.jc(),innerWidth:a.Ya(),innerHeight:a.Oa()})}function gb(a,b){a.yd!==b&&((a.yd=b)?a.B.he():a.B.se(),k(a,"visibilitychange",{hidden:b}))}
function mb(a,b,c){"Backspace"===c.key&&H(c);if(!a.wa){var d=Oa.get(c.code)||c.code;ba(a,b,{code:d,key:c.key,which:c.which,repeat:c.repeat,altKey:c.altKey,ctrlKey:c.ctrlKey,metaKey:c.metaKey,shiftKey:c.shiftKey,timeStamp:c.timeStamp},B)}}function nb(a,b,c,d){a.wa||Na(c)||ba(a,b,{button:c.button,buttons:c.buttons,clientX:c.clientX,clientY:c.clientY+a.Da,pageX:c.pageX,pageY:c.pageY+a.Da,movementX:c.movementX||0,movementY:c.movementY||0,timeStamp:c.timeStamp},d)}
function ob(a){window!==window.top&&window.focus();pb(a.target)&&document.activeElement&&!pb(document.activeElement)&&document.activeElement.blur()}
function rb(a,b,c){if(!a.wa){var d=0;"mouse"===c.pointerType&&(d=a.Hc);ba(a,b,{pointerId:c.pointerId,pointerType:c.pointerType,button:c.button,buttons:c.buttons,lastButtons:d,clientX:c.clientX,clientY:c.clientY+a.Da,pageX:c.pageX,pageY:c.pageY+a.Da,movementX:c.movementX||0,movementY:c.movementY||0,width:c.width||0,height:c.height||0,pressure:c.pressure||0,tangentialPressure:c.tangentialPressure||0,tiltX:c.tiltX||0,tiltY:c.tiltY||0,twist:c.twist||0,timeStamp:c.timeStamp},B);"mouse"===c.pointerType&&
(d="mousemove","pointerdown"===b?d="mousedown":"pointerup"===b&&(d="mouseup"),nb(a,d,c,Pa),a.Hc=c.buttons)}}
function sb(a,b,c){if(!a.wa&&!Na(c)){var d=a.Hc;"pointerdown"===b&&0!==d?b="pointermove":"pointerup"===b&&0!==c.buttons&&(b="pointermove");ba(a,b,{pointerId:1,pointerType:"mouse",button:c.button,buttons:c.buttons,lastButtons:d,clientX:c.clientX,clientY:c.clientY+a.Da,pageX:c.pageX,pageY:c.pageY+a.Da,movementX:c.movementX||0,movementY:c.movementY||0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,timeStamp:c.timeStamp},B);a.Hc=c.buttons;nb(a,c.type,c,Pa)}}
function tb(a,b,c){if(!a.wa)for(let d=0,e=c.changedTouches.length;d<e;++d){const f=c.changedTouches[d];ba(a,b,{pointerId:f.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:f.clientX,clientY:f.clientY+a.Da,pageX:f.pageX,pageY:f.pageY+a.Da,movementX:c.movementX||0,movementY:c.movementY||0,width:2*(f.radiusX||f.webkitRadiusX||0),height:2*(f.radiusY||f.webkitRadiusY||0),pressure:f.force||f.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:f.rotationAngle||0,timeStamp:c.timeStamp},
B)}}function ub(a,b,c){document.body.style.transform="";a.Da=0;if(0<c){var d=document.activeElement;d&&(d=d.getBoundingClientRect(),b=(d.top+d.bottom)/2-(b-c)/2,b>c&&(b=c),0>b&&(b=0),0<b&&(document.body.style.transform=`translateY(${-b}px)`,a.Da=b))}}function vb(a,b,c,d){const e=a.Ya(),f=a.Oa();a.ac=-1;e!=b||f!=c?k(a,"window-resize",{innerWidth:e,innerHeight:f,devicePixelRatio:window.devicePixelRatio,isFullscreen:Ma.jc()}):10>d&&wb(a,e,f,d+1)}
function wb(a,b,c,d){-1!==a.ac&&clearTimeout(a.ac);a.ac=setTimeout(()=>vb(a,b,c,d),48)}
function ab(a){a=a.gf;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(a).catch(b=>console.warn("[Construct] Failed to lock orientation: ",b));else try{let b=!1;screen.lockOrientation?b=screen.lockOrientation(a):screen.webkitLockOrientation?b=screen.webkitLockOrientation(a):screen.mozLockOrientation?b=screen.mozLockOrientation(a):screen.msLockOrientation&&(b=screen.msLockOrientation(a));b||console.warn("[Construct] Failed to lock orientation")}catch(b){console.warn("[Construct] Failed to lock orientation: ",
b)}}function pb(a){return!a||a===document||a===window||a===document.body||"canvas"===a.tagName.toLowerCase()}
Ma.hb(class extends self.qb{constructor(a){super(a,"runtime");this.Zf=!0;this.Tf=!1;this.ac=-1;this.gf="any";this.yd=this.Kf=this.Lf=!1;this.Ed=document.createElement("div");this.Ed.className="c3-screen-reader-text";this.Ed.setAttribute("aria-live","polite");document.body.appendChild(this.Ed);this.Bb=null;this.wa=!1;this.Vf="";this.Be=-1;this.Sf=!1;this.Ve=a.Ya();this.Cc=a.Oa();this.Da=this.Sc=0;a.K("canvas","update-size",d=>{var e=this.B;e.Ne||(e=e.V,e.style.width=d.styleWidth+"px",e.style.height=
d.styleHeight+"px",e.style.marginLeft=d.marginLeft+"px",e.style.marginTop=d.marginTop+"px",document.documentElement.style.setProperty("--construct-scale",d.displayScale),this.Zf&&(e.style.display="",this.Zf=!1))});a.K("runtime","invoke-download",d=>{const e=d.url;d=d.filename;const f=document.createElement("a"),g=document.body;f.textContent=d;f.href=e;f.download=d;g.appendChild(f);f.click();g.removeChild(f)});a.K("runtime","load-webfonts",d=>bb(d));a.K("runtime","raster-svg-image",d=>cb(d));a.K("runtime",
"get-svg-image-size",d=>db(d));a.K("runtime","set-target-orientation",d=>{this.gf=d.targetOrientation});a.K("runtime","register-sw",()=>{window.C3_RegisterSW&&window.C3_RegisterSW()});a.K("runtime","post-to-debugger",d=>eb(d));a.K("runtime","go-to-script",d=>eb(d));a.K("runtime","before-start-ticking",()=>fb(this));a.K("runtime","debug-highlight",d=>{if(d.show){this.Bb||(this.Bb=document.createElement("div"),this.Bb.id="inspectOutline",document.body.appendChild(this.Bb));var e=this.Bb;e.style.display=
"";e.style.left=d.left-1+"px";e.style.top=d.top-1+"px";e.style.width=d.width+2+"px";e.style.height=d.height+2+"px";e.textContent=d.name}else this.Bb&&(this.Bb.style.display="none")});a.K("runtime","enable-device-orientation",()=>hb(this));a.K("runtime","enable-device-motion",()=>ib(this));a.K("runtime","add-stylesheet",d=>jb(d));a.K("runtime","script-create-worker",d=>{const e=d.port2;(new Worker(d.url,d.opts)).postMessage({type:"construct-worker-init",port2:e},[e])});a.K("runtime","alert",d=>this.me(d));
a.K("runtime","screen-reader-text",d=>{var e=d.type;"create"===e?(e=document.createElement("p"),e.id="c3-sr-"+d.id,e.textContent=d.text,this.Ed.appendChild(e)):"update"===e?(e=document.getElementById("c3-sr-"+d.id))?e.textContent=d.text:console.warn(`[Construct] Missing screen reader text with id ${d.id}`):"release"===e?(e=document.getElementById("c3-sr-"+d.id))?e.remove():console.warn(`[Construct] Missing screen reader text with id ${d.id}`):console.warn(`[Construct] Unknown screen reader text update '${e}'`)});
a.K("runtime","hide-cordova-splash",()=>{navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()});a.K("runtime","set-exporting-to-video",d=>{this.wa=!0;const e=document.createElement("h1");e.id="exportToVideoMessage";e.textContent=d.message;document.body.prepend(e);document.body.classList.add("exportingToVideo");this.B.V.style.display="";this.B.ih(d.duration)});a.K("runtime","export-to-video-progress",d=>kb(this,d));a.K("runtime","exported-to-video",d=>{window.Rh({type:"exported-video",
arrayBuffer:d.arrayBuffer,contentType:d.contentType,time:d.time})});a.K("runtime","exported-to-image-sequence",d=>{window.Rh({type:"exported-image-sequence",blobArr:d.blobArr,time:d.time,gif:d.gif})});const b=new Set(["input","textarea","datalist"]);window.addEventListener("contextmenu",d=>{const e=d.target;b.has(e.tagName.toLowerCase())||Wa(e)||d.preventDefault()});const c=a.V;window.addEventListener("selectstart",H);window.addEventListener("gesturehold",H);c.addEventListener("selectstart",H);c.addEventListener("gesturehold",
H);window.addEventListener("touchstart",H,{passive:!1});"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",H,{passive:!1}),c.addEventListener("pointerdown",H)):c.addEventListener("touchstart",H);this.Hc=0;window.addEventListener("mousedown",d=>{1===d.button&&d.preventDefault()});window.addEventListener("mousewheel",Za,{passive:!1});window.addEventListener("wheel",Za,{passive:!1});window.addEventListener("resize",()=>{a:{if(!this.wa&&this.Tf){var d=this.Ya();var e=this.Oa();if(this.B.zf()){if(this.Sf){if(this.Ve===
d&&e<this.Cc){this.Sc=this.Cc-e;ub(this,this.Cc,this.Sc);d=void 0;break a}0<this.Sc&&(this.Sc=0,ub(this,e,this.Sc))}this.Ve=d;this.Cc=e}k(this,"window-resize",{innerWidth:d,innerHeight:e,devicePixelRatio:window.devicePixelRatio,isFullscreen:Ma.jc()});this.B.ae()&&(-1!==this.ac&&clearTimeout(this.ac),vb(this,d,e,0))}d=void 0}return d});window.addEventListener("fullscreenchange",()=>La(this));window.addEventListener("webkitfullscreenchange",()=>La(this));window.addEventListener("mozfullscreenchange",
()=>La(this));window.addEventListener("fullscreenerror",d=>lb(this,d));window.addEventListener("webkitfullscreenerror",d=>lb(this,d));window.addEventListener("mozfullscreenerror",d=>lb(this,d));if(a.ae())if(window.visualViewport){let d=Infinity;window.visualViewport.addEventListener("resize",()=>{const e=window.visualViewport.height;e>d&&(document.scrollingElement.scrollTop=0);d=e})}else window.addEventListener("focusout",()=>{{const f=document.activeElement;if(f){var d=f.tagName.toLowerCase();var e=
new Set("email number password search tel text url".split(" "));d="textarea"===d?!0:"input"===d?e.has(f.type.toLowerCase()||"text"):Wa(f)}else d=!1}d||(document.scrollingElement.scrollTop=0)});this.Sb=new Set;this.wd=new WeakSet;this.lb=!1}rf(){window.addEventListener("focus",()=>{k(this,"window-focus",null,Qa)});window.addEventListener("blur",()=>{try{var b=window.parent&&window.parent.document.hasFocus()}catch(c){b=!1}k(this,"window-blur",{parentHasFocus:b},Qa);this.Hc=0});window.addEventListener("focusin",
b=>{b=b.target;(Xa.has(b.tagName.toLowerCase())||Wa(b))&&k(this,"keyboard-blur",null,Qa)});window.addEventListener("keydown",b=>mb(this,"keydown",b));window.addEventListener("keyup",b=>mb(this,"keyup",b));window.addEventListener("dblclick",b=>nb(this,"dblclick",b,B));window.addEventListener("wheel",b=>{this.wa||k(this,"wheel",{clientX:b.clientX,clientY:b.clientY+this.Da,pageX:b.pageX,pageY:b.pageY+this.Da,deltaX:b.deltaX,deltaY:b.deltaY,deltaZ:b.deltaZ,deltaMode:b.deltaMode,timeStamp:b.timeStamp},
B)});"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",b=>{ob(b);rb(this,"pointerdown",b)}),this.B.Ca&&"undefined"!==typeof window.onpointerrawupdate&&self===self.top?window.addEventListener("pointerrawupdate",b=>{rb(this,"pointermove",b)}):window.addEventListener("pointermove",b=>rb(this,"pointermove",b)),window.addEventListener("pointerup",b=>rb(this,"pointerup",b)),window.addEventListener("pointercancel",b=>rb(this,"pointercancel",b))):(window.addEventListener("mousedown",
b=>{ob(b);sb(this,"pointerdown",b)}),window.addEventListener("mousemove",b=>sb(this,"pointermove",b)),window.addEventListener("mouseup",b=>sb(this,"pointerup",b)),window.addEventListener("touchstart",b=>{ob(b);tb(this,"pointerdown",b)}),window.addEventListener("touchmove",b=>tb(this,"pointermove",b)),window.addEventListener("touchend",b=>tb(this,"pointerup",b)),window.addEventListener("touchcancel",b=>tb(this,"pointercancel",b)));const a=()=>this.re();window.addEventListener("pointerup",a,!0);window.addEventListener("touchend",
a,!0);window.addEventListener("click",a,!0);window.addEventListener("keydown",a,!0);window.addEventListener("gamepadconnected",a,!0);this.B.dh()&&!this.B.zf()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{ub(this,this.Oa(),navigator.virtualKeyboard.boundingRect.height)}))}Ya(){return this.B.Ya()}Oa(){return this.B.Oa()}re(){var a=[...this.Sb];this.Sb.clear();if(!this.lb)for(const b of a)(a=b.play())&&a.catch(()=>
{this.wd.has(b)||this.Sb.add(b)})}tb(a){if("function"!==typeof a.play)throw Error("missing play function");this.wd.delete(a);let b;try{b=a.play()}catch(c){this.Sb.add(a);return}b&&b.catch(()=>{this.wd.has(a)||this.Sb.add(a)})}Kb(a){this.Sb.delete(a);this.wd.add(a)}Yc(a){this.lb=!!a}me(a){alert(a.message)}});"use strict";
async function Ha(a){if(a.Gh)throw Error("already initialised");a.Gh=!0;var b=a.ob.je(("playable-ad"===a.ob.G?a.ob.$b:"")+"dispatchworker.js");a.ze=await a.ob.Vd(b,a.oc,{name:"DispatchWorker"});b=new MessageChannel;a.Le=b.port1;a.ze.postMessage({type:"_init","in-port":b.port2},[b.port2]);a.$e=await Ka(a)}function Ia(a){return[a.Le,a.$e]}
async function Ka(a){const b=a.ag.length;var c=a.ob.je(("playable-ad"===a.ob.G?a.ob.$b:"")+"jobworker.js");c=await a.ob.Vd(c,a.oc,{name:"JobWorker"+b});const d=new MessageChannel,e=new MessageChannel;a.ze.postMessage({type:"_addJobWorker",port:d.port1},[d.port1]);c.postMessage({type:"init",number:b,"dispatch-port":d.port2,"output-port":e.port2},[d.port2,e.port2]);a.ag.push(c);return e.port1}
self.gh=class{constructor(a){this.ob=a;this.oc=a.Ba;this.oc="preview"===a.G?this.oc+"workers/":this.oc+a.$b;this.Ih=Math.min(navigator.hardwareConcurrency||2,16);this.ze=null;this.ag=[];this.$e=this.Le=null}};"use strict";window.C3_IsSupported&&(window.c3_runtimeInterface=new self.Ea({ai:!0,bi:"workermain.js",dc:["scripts/c3runtime.js"],Pd:[],nf:"",Yh:"scripts/",Qd:[],ug:"html5"}));"use strict";
self.Ea.hb(class extends self.qb{constructor(a){super(a,"mouse");ca(this,[["cursor",b=>{document.documentElement.style.cursor=b}],["request-pointer-lock",()=>{this.B.V.requestPointerLock()}],["release-pointer-lock",()=>{document.exitPointerLock()}]]);document.addEventListener("pointerlockchange",()=>{k(this,"pointer-lock-change",{"has-pointer-lock":!!document.pointerLockElement})});document.addEventListener("pointerlockerror",()=>{k(this,"pointer-lock-error",{"has-pointer-lock":!!document.pointerLockElement})})}});
"use strict";function xb(){}function yb(a){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(b=>k(a,"sw-message",b.data))}
function zb(a){a=a.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(a).catch(b=>console.warn("[Construct] Failed to lock orientation: ",b));else try{let b=!1;screen.lockOrientation?b=screen.lockOrientation(a):screen.webkitLockOrientation?b=screen.webkitLockOrientation(a):screen.mozLockOrientation?b=screen.mozLockOrientation(a):screen.msLockOrientation&&(b=screen.msLockOrientation(a));b||console.warn("[Construct] Failed to lock orientation")}catch(b){console.warn("[Construct] Failed to lock orientation: ",
b)}}
self.Ea.hb(class extends self.qb{constructor(a){super(a,"browser");this.G="";ca(this,[["get-initial-state",b=>{this.G=b.exportType;return{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isConstructArcade:"undefined"!==typeof window.is_scirra_arcade}}],["ready-for-sw-messages",()=>
yb(this)],["alert",b=>this.me(b)],["close",()=>this.ne()],["set-focus",b=>this.qe(b)],["vibrate",b=>{navigator.vibrate&&navigator.vibrate(b.pattern)}],["lock-orientation",b=>zb(b)],["unlock-orientation",()=>{try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(b){}}],
["navigate",b=>{var c=b.type;if("back"===c)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if("forward"===c)window.history.forward();else if("reload"===c)location.reload();else if("url"===c){c=b.url;const d=b.target;b=b.exportType;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(c,"_system"):"preview"===b||this.B.jb()?window.open(c,"_blank"):this.gi||(2===d?window.top.location=c:1===d?window.parent.location=c:window.location=c)}else"new-window"===
c&&(c=b.url,b=b.tag,self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(c,"_system"):window.open(c,b))}],["request-fullscreen",b=>{if(this.B.jb()||"macos-wkwebview"===this.G)self.Ea.ad(!0),this.B.ub({type:"set-fullscreen",fullscreen:!0});else{const c={navigationUI:"auto"};b=b.navUI;1===b?c.navigationUI="hide":2===b&&(c.navigationUI="show");b=document.documentElement;let d;b.requestFullscreen?d=b.requestFullscreen(c):b.mozRequestFullScreen?d=b.mozRequestFullScreen(c):b.msRequestFullscreen?
d=b.msRequestFullscreen(c):b.webkitRequestFullScreen&&(d="undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?b.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):b.webkitRequestFullScreen());d instanceof Promise&&d.catch(xb)}}],["exit-fullscreen",()=>{if(this.B.jb()||"macos-wkwebview"===this.G)self.Ea.ad(!1),this.B.ub({type:"set-fullscreen",fullscreen:!1});else{let b;document.exitFullscreen?b=document.exitFullscreen():document.mozCancelFullScreen?b=document.mozCancelFullScreen():document.msExitFullscreen?
b=document.msExitFullscreen():document.webkitCancelFullScreen&&(b=document.webkitCancelFullScreen());b instanceof Promise&&b.catch(xb)}}],["set-hash",b=>{location.hash=b.hash}],["set-document-css-style",b=>{const c=b.prop,d=b.value;var e=b.selector;b=b["is-all"];try{if(e)if(b)var f=Array.from(document.querySelectorAll(e));else{var g=document.querySelector(e);f=g?[g]:[]}else f=[document.documentElement];e=f;for(const h of e)c.startsWith("--")?h.style.setProperty(c,d):h.style[c]=d}catch(h){console.warn("[Browser] Failed to set style: ",
h)}}],["get-document-css-style",b=>{{const d=b.prop;b=b.selector;try{const e=document.querySelector(b);var c=e?{isOk:!0,result:window.getComputedStyle(e).getPropertyValue(d)}:{isOk:!1}}catch(e){console.warn("[Browser] Failed to get style: ",e),c={isOk:!1}}}return c}]]);window.addEventListener("online",()=>{k(this,"online-state",{isOnline:!0})});window.addEventListener("offline",()=>{k(this,"online-state",{isOnline:!1})});window.addEventListener("hashchange",()=>{k(this,"hashchange",{location:location.toString()})});
document.addEventListener("backbutton",()=>{k(this,"backbutton")})}me(a){alert(a.message)}ne(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}qe(a){a=a.isFocus;if("nwjs"===this.G){const b="nwjs"===this.G?nw.Window.get():null;a?b.focus():b.blur()}else a?window.focus():window.blur()}});"use strict";const Ab=180/Math.PI;
async function Bb(a,b){if(b.isiOSCordova||b.isSafari)a.Ad=!0;a.hf=b.timeScaleMode;a.kg=["equalpower","HRTF","soundfield"][b.panningModel];a.Rf=["linear","inverse","exponential"][b.distanceModel];a.mg=b.refDistance;a.jg=b.maxDistance;a.og=b.rolloffFactor;if(a.B.Ne)a.Ad=!0,a.h=new OfflineAudioContext({numberOfChannels:2,sampleRate:48E3,length:Math.ceil(48E3*a.B.Uf)});else{var c={latencyHint:b.latencyHint};a.rg||(c.sampleRate=48E3);if("undefined"!==typeof AudioContext)a.h=new AudioContext(c);else if("undefined"!==
typeof webkitAudioContext)a.h=new webkitAudioContext(c);else throw Error("Web Audio API not supported");Cb(a);a.h.onstatechange=()=>{"running"!==a.h.state&&Cb(a);k(a,"audiocontext-state",{audioContextState:a.h.state})}}a.Nb=a.h.createGain();a.Nb.connect(a.h.destination);c=b.listenerPos;a.ya[0]=c[0];a.ya[1]=c[1];a.ya[2]=c[2];a.h.listener.setPosition(c[0],c[1],c[2]);a.h.listener.setOrientation(...a.Ha);self.C3_GetAudioContextCurrentTime=()=>a.h.currentTime;try{await Promise.all(b.preloadList.map(d=>
Db(a,d.originalUrl,d.url,d.type,!1)))}catch(d){console.error("[Construct] Preloading sounds failed: ",d)}return{sampleRate:a.h.sampleRate,audioContextState:a.h.state,outputLatency:a.h.outputLatency||0}}
async function Eb(a,b){var c=b.originalUrl,d=b.url;const e=b.type,f=b.isMusic,g=b.tags,h=b.isLooping,l=b.vol,v=b.pos,q=b.panning,D=b.stereoPan;let y=b.off;0<y&&!b.trueClock&&(a.h.getOutputTimestamp?(b=a.h.getOutputTimestamp(),y=y-b.performanceTime/1E3+b.contextTime):y=y-performance.now()/1E3+a.h.currentTime);a.cg=g.slice(0);Fb(a,g);try{a.ia=await Gb(a,c,d,e,g,f);if(q){Hb(a.ia,!0);var t=a.ia,u=q.innerAngle,F=q.outerAngle,I=q.outerGain;if(t.yc){Ib(t,q.x,q.y,q.z,q.angle);var w=self.fc.jh;t.bb[0]!==w(u)&&
(t.bb[0]=w(u),t.P.coneInnerAngle=w(u));t.bb[1]!==w(F)&&(t.bb[1]=w(F),t.P.coneOuterAngle=w(F));t.bb[2]!==I&&(t.bb[2]=I,t.P.coneOuterGain=I)}q.hasOwnProperty("uid")&&(a.ia.Za=q.uid)}else"number"===typeof D&&0!==D?(Jb(a.ia,!0),Kb(a.ia,D)):(Hb(a.ia,!1),Jb(a.ia,!1));a.ia.Play(h,l,v,y)}catch(X){console.error("[Construct] Audio: error starting playback: ",X);return}finally{c=g.join(" ");d=a.Nc.get(c);if(!d)throw Error("expected pending tag");d.qf--;0===d.qf&&(d.resolve(),a.Nc.delete(c))}da(a)}
async function Lb(a,b){var c=b.tags;const d=b.vol,e=b.duration;b=b.stopOnEnd;await Mb(a,c);for(const h of J(a,c))if(!h.Qb){c=h.R.gain;c.cancelScheduledValues(0);var f=h.F.h.currentTime,g=f+e;c.setValueAtTime(c.value,f);c.linearRampToValueAtTime(d,g);h.Hb=d;h.Ob=g;h.qg=b}Nb(a)}async function Ob(a,b){const c=b.tags;b=b.rate;await Mb(a,c);for(const d of J(a,c))d.Va!==b&&(d.Va=b,d.wb())}async function Pb(a,b){const c=b.tags;b=b.pos;await Mb(a,c);for(const d of J(a,c))d.ce(b)}
async function Qb(a,b){const c=b.originalUrl,d=b.url,e=b.type;b=b.isMusic;try{await Gb(a,c,d,e,"",b)}catch(f){console.error("[Construct] Audio: error preloading: ",f)}}async function Rb(a,b){if(b=await Db(a,"",b.url,b.type,b.isMusic,!0))b.o(),b=a.Sa.indexOf(b),-1!==b&&a.Sa.splice(b,1)}
async function Sb(a,b){const c=b.type;var d=b.tags;const e=b.params;let f;if("convolution"===c)try{f=await Db(a,b.bufferOriginalUrl,b.bufferUrl,b.bufferType,!1)}catch(l){console.log("[Construct] Audio: error loading convolution: ",l);return}for(const l of d){if("filter"===c)d=new self.Lg(a,...e);else if("delay"===c)d=new self.Jg(a,...e);else if("convolution"===c){var g=d=new self.Ig(a,f.Ra,...e),h=b.bufferType;g.Nf=b.bufferOriginalUrl;g.Of=h}else if("flanger"===c)d=new self.Mg(a,...e);else if("phaser"===
c)d=new self.Og(a,...e);else if("gain"===c)d=new self.Ng(a,...e);else if("stereopan"===c)d=new self.Qg(a,...e);else if("tremolo"===c)d=new self.Rg(a,...e);else if("ringmod"===c)d=new self.Pg(a,...e);else if("distortion"===c)d=new self.Kg(a,...e);else if("compressor"===c)d=new self.Hg(a,...e);else if("analyser"===c)d=new self.Gg(a,...e);else throw Error("invalid effect type");g=a;h=l;h=h.toLowerCase();let v=g.Ta.get(h);v||(v=[],g.Ta.set(h,v));d.vc=v.length;d.eb=h;v.push(d);Tb(g,h)}Ub(a)}
async function Vb(a,b){try{const c=a.h.suspend(b.time);a.Yf?a.h.resume():(a.h.startRendering().then(d=>{const e=[];for(let f=0,g=d.numberOfChannels;f<g;++f){const h=d.getChannelData(f);e.push(h.buffer)}a.B.lc("runtime","offline-audio-render-completed",{duration:d.duration,length:d.length,numberOfChannels:d.numberOfChannels,sampleRate:d.sampleRate,channelData:e},null,e)}).catch(d=>Wb(d)),a.Yf=!0);await c}catch(c){Wb(c)}}
function Cb(a){a.md||(a.Ie=!1,window.addEventListener("pointerup",a.pb,!0),window.addEventListener("touchend",a.pb,!0),window.addEventListener("click",a.pb,!0),window.addEventListener("keydown",a.pb,!0),a.md=!0)}
async function Db(a,b,c,d,e,f){for(var g of a.Sa)if(g.ic()===c)return await Xb(g),g;if(f)return null;if(e&&(a.Ad||a.Xf)){f=0;for(let h=0,l=a.Sa.length;h<l;++h)g=a.Sa[h],a.Sa[f]=g,g.rb()?g.o():++f;a.Sa.length=f}f="audio/webm; codecs=opus"===d&&!a.rg;e&&f&&(a.Xf=!0);c=!e||a.Ad||f?new self.Yg(a,b,c,d,e,f):new self.Sg(a,b,c,d,e);a.Sa.push(c);await Xb(c);a.hg.has(b)||(k(a,"buffer-metadata",{originalUrl:b,duration:c.Na()}),a.hg.add(b));return c}
function Yb(a,b){return a===b||a.normalize().toLowerCase()===b.normalize().toLowerCase()}function Zb(a,b){return(b=a.Ta.get(b.toLowerCase()))?b[0].da():a.Ma()}function Tb(a,b){b=b.toLowerCase();let c=a.Ma();var d=a.Ta.get(b);if(d&&d.length){c=d[0].da();for(let f=0,g=d.length;f<g;++f){var e=d[f];f+1===g?e.la(a.Ma()):e.la(d[f+1].da())}}for(const f of $b(a,b))d=c,e=f.Ka||f.P||f.R,e.disconnect(),e.connect(d);a.Fb&&a.We===b&&(a.Fb.disconnect(),a.Fb.connect(c))}
function*$b(a,b){if(b)for(const c of a.U)Yb(0<c.Xa.length?c.Xa[0]:"",b)&&(yield c);else a.ia&&!a.ia.ea()&&(yield a.ia)}function ac(a,b,c){return c?a.B.Fh(b).then(d=>{const e=a.h.createBuffer(1,d.length,48E3);e.getChannelData(0).set(d);return e}):new Promise((d,e)=>{a.h.decodeAudioData(b,d,e)})}function bc(a,b){let c=0;for(let d=0,e=a.U.length;d<e;++d){const f=a.U[d];a.U[c]=f;f.ha===b?f.o():++c}a.U.length=c}
function*J(a,b){if(0<b.length)for(const d of a.U){a:{a=d.Xa;var c=b;for(const e of c){c=!1;for(const f of a)if(Yb(f,e)){c=!0;break}if(!c){a=!1;break a}}a=!0}a&&(yield d)}else a.ia&&!a.ia.ea()&&(yield a.ia)}async function Gb(a,b,c,d,e,f){for(const g of a.U)if(g.ic()===c&&(g.Td()||f))return g.Xa=e,g;b=await Db(a,b,c,d,f);e="html5"===b.ue?new self.Tg(b.F,b,e):new self.Zg(b.F,b,e);a.U.push(e);return e}
function Fb(a,b){b=b.join(" ");let c=a.Nc.get(b);if(!c){let d=null;c={qf:0,promise:new Promise(e=>d=e),resolve:d};a.Nc.set(b,c)}c.qf++}function Mb(a,b){return(a=a.Nc.get((0===b.length?a.cg:b).join(" ")))?a.promise:Promise.resolve()}function Nb(a){if(0<a.Mb.size)da(a);else for(const b of a.U)if(!b.W&&!b.ea()){da(a);break}}function cc(a,b,c,d){k(a,"trigger",{type:b,tags:c,aiid:d})}function Ub(a){a.Oe||(a.Oe=!0,Promise.resolve().then(()=>dc(a)))}
function dc(a){const b={};for(const [c,d]of a.Ta)b[c]=d.map(e=>e.hc());k(a,"fxstate",{fxstate:b});a.Oe=!1}
async function ec(a,b,c){if(3!==c){var d=b.bufferOriginalUrl,e=b.bufferUrl,f=b.bufferType,g=b.isMusic,h=b.tags,l=b.isLooping,v=b.volume,q=b.playbackTime;if(!g||1!==c)if(g||2!==c){c=null;try{c=await Gb(a,d,e,f,h,g)}catch(D){console.error("[Construct] Audio: error loading audio state: ",D);return}a=c;(d=b.pan)?(Hb(a,!0),e=a.P,f=d.pos,a.Vb[0]=f[0],a.Vb[1]=f[1],a.Vb[2]=f[2],f=d.orient,a.Ub[0]=f[0],a.Ub[1]=f[1],a.Ub[2]=f[2],e.setPosition(...a.Vb),e.setOrientation(...a.Ub),a.bb[0]=d.cia,a.bb[1]=d.coa,a.bb[2]=
d.cog,e.coneInnerAngle=d.cia,e.coneOuterAngle=d.coa,e.coneOuterGain=d.cog,a.Za=d.uid):Hb(a,!1);a=c;d=b.stereoPan;"number"!==typeof d?Jb(a,!1):(Jb(a,!0),Kb(a,d));c.Play(l,v,q,0);b.isPlaying||c.kc();c.le(b)}}}function Wb(a){console.error("[Audio] Offline rendering error: ",a)}
self.fc=class extends self.qb{constructor(a){super(a,"audio");this.Nb=this.h=null;this.md=this.Ie=!1;this.pb=()=>{if(!this.Ie){var b=this.h;"suspended"===b.state&&b.resume&&b.resume();var c=b.createBuffer(1,220,22050),d=b.createBufferSource();d.buffer=c;d.connect(b.destination);d.start(0);"running"===b.state&&this.md&&(this.Ie=!0,window.removeEventListener("pointerup",this.pb,!0),window.removeEventListener("touchend",this.pb,!0),window.removeEventListener("click",this.pb,!0),window.removeEventListener("keydown",
this.pb,!0),this.md=!1)}};this.Sa=[];this.U=[];this.ia=null;this.cg=[];this.hg=new Set;this.fg=-1;this.Nc=new Map;this.vd=1;this.lb=!1;this.hf=0;this.Gd=1;this.Ee=0;this.kg="HRTF";this.Rf="inverse";this.mg=600;this.jg=1E4;this.og=1;this.ya=[0,0,0];this.Ha=[0,0,-1,0,1,0];this.Xf=this.Ad=!1;this.rg=this.B.eh();this.Ta=new Map;this.Mb=new Set;this.Yf=this.Oe=!1;this.We="";this.Fb=null;self.C3Audio_OnMicrophoneStream=(b,c)=>{this.Fb&&this.Fb.disconnect();this.We=c.toLowerCase();this.Fb=this.h.createMediaStreamSource(b);
this.Fb.connect(Zb(this,this.We))};this.hd=null;self.C3Audio_GetOutputStream=()=>{this.hd||(this.hd=this.h.createMediaStreamDestination(),this.Nb.connect(this.hd));return this.hd.stream};self.C3Audio_DOMInterface=this;ca(this,[["create-audio-context",b=>Bb(this,b)],["play",b=>Eb(this,b)],["stop",b=>{b=b.tags;for(const c of J(this,b))c.sb()}],["stop-all",()=>{for(const b of this.U)b.sb()}],["set-paused",b=>{const c=b.tags;b=b.paused;for(const d of J(this,c))b?d.kc():d.Xc();Nb(this)}],["set-volume",
b=>{const c=b.tags;b=b.vol;for(const d of J(this,c))gc(d,b)}],["fade-volume",b=>Lb(this,b)],["set-master-volume",b=>{this.vd=b.vol;this.Nb.gain.value=this.vd}],["set-muted",b=>{const c=b.tags;b=b.isMuted;for(const d of J(this,c))hc(d,b)}],["set-silent",b=>{this.lb=b.isSilent;this.B.Yc(this.lb);for(const c of this.U)c.bd()}],["set-looping",b=>{const c=b.tags;b=b.isLooping;for(const d of J(this,c))d.de(b)}],["set-playback-rate",b=>Ob(this,b)],["set-stereo-pan",b=>{const c=b.tags;b=b.p;for(const d of J(this,
c))Jb(d,!0),Kb(d,b)}],["seek",b=>Pb(this,b)],["preload",b=>Qb(this,b)],["unload",b=>Rb(this,b)],["unload-all",()=>{for(const b of this.Sa)b.o();this.Sa.length=0}],["set-suspended",b=>{b=b.isSuspended;!b&&this.h.resume&&this.h.resume();for(const c of this.U)c.ee(b);b&&this.h.suspend&&this.h.suspend()}],["add-effect",b=>Sb(this,b)],["set-effect-param",b=>{var c=b.tags;const d=b.index,e=b.param,f=b.value,g=b.ramp;b=b.time;for(const h of c)c=this.Ta.get(h.toLowerCase()),!c||0>d||d>=c.length||c[d].ua(e,
f,g,b);Ub(this)}],["remove-effects",b=>{b=b.tags;for(const c of b){b=c.toLowerCase();const d=this.Ta.get(b);if(!d||!d.length)break;for(const e of d)e.o();this.Ta.delete(b);Tb(this,b)}}],["tick",b=>{this.Gd=b.timeScale;this.Ee=b.gameTime;this.fg=b.tickCount;if(0!==this.hf)for(var c of this.U)c.wb();!(c=b.listenerPos)||this.ya[0]===c[0]&&this.ya[1]===c[1]&&this.ya[2]===c[2]||(this.ya[0]=c[0],this.ya[1]=c[1],this.ya[2]=c[2],this.h.listener.setPosition(c[0],c[1],c[2]));if((c=b.listenerOrientation)&&(this.Ha[0]!==
c[0]||this.Ha[1]!==c[1]||this.Ha[2]!==c[2]||this.Ha[3]!==c[3]||this.Ha[4]!==c[4]||this.Ha[5]!==c[5])){for(let d=0;6>d;++d)this.Ha[d]=c[d];this.h.listener.setOrientation(...this.Ha)}for(const d of b.instPans){b=d.uid;for(const e of this.U)e.Za===b&&Ib(e,d.x,d.y,d.z,d.angle)}}],["load-state",b=>this.pe(b)],["offline-render-audio",b=>Vb(this,b)],["offline-render-finish",()=>{this.h.resume()}]])}ma(){return this.h}Ma(){return this.Nb}GetAudioContextExtern(){return this.ma()}GetDestinationNodeExtern(){return this.Ma()}Wc(){return this.lb}tb(a){this.B.tb(a)}Kb(a){this.B.Kb(a)}fa(){for(var a of this.Mb)a.fa();
a=this.h.currentTime;for(var b of this.U)b.fa(a);b=this.U.filter(c=>!c.W&&!c.ea()).map(c=>c.hc());k(this,"state",{tickCount:this.fg,outputLatency:this.h.outputLatency||0,audioInstances:b,analysers:[...this.Mb].map(c=>({tag:c.eb,index:c.vc,peak:c.Wb,rms:c.ng,binCount:c.v.frequencyBinCount,freqBins:c.Wf}))});0===b.length&&0===this.Mb.size&&this.nd&&(this.B.Dh(this.sg),this.nd=!1)}async pe(a){const b=a.saveLoadMode;if(3!==b){var c=[];for(var d of this.U)d.rb()&&1===b||!d.rb()&&2===b?c.push(d):d.o();
this.U=c}for(const e of this.Ta.values())for(const f of e)f.o();this.Ta.clear();this.Gd=a.timeScale;this.Ee=a.gameTime;c=a.listenerPos;this.ya[0]=c[0];this.ya[1]=c[1];this.ya[2]=c[2];this.h.listener.setPosition(c[0],c[1],c[2]);c=a.listenerOrientation;if(Array.isArray(c)){for(d=0;6>d;++d)this.Ha[d]=c[d];this.h.listener.setOrientation(...this.Ha)}this.lb=a.isSilent;this.B.Yc(this.lb);this.vd=a.masterVolume;this.Nb.gain.value=this.vd;c=[];for(const e of Object.values(a.effects))c.push(Promise.all(e.map(f=>
Sb(this,f))));await Promise.all(c);await Promise.all(a.playing.map(e=>ec(this,e,b)));Nb(this)}static jh(a){return a*Ab}static wf(a){return Math.max(Math.min(Math.pow(10,a/20),1),0)}static hh(a){return Math.log(Math.max(Math.min(a,1),0))/Math.log(10)*20}};self.Ea.hb(self.fc);"use strict";function Xb(a){a.td||(a.td=a.ke());return a.td}self.sf=class{constructor(a,b,c,d,e){this.F=a;this.Mh=b;this.Gb=c;this.ka=d;this.Hh=e;this.ue="";this.td=null}o(){this.td=this.F=null}ke(){}ma(){return this.F.ma()}Yd(){return this.Mh}ic(){return this.Gb}Xd(){return this.ka}rb(){return this.Hh}Na(){}};
"use strict";
self.Sg=class extends self.sf{constructor(a,b,c,d,e){super(a,b,c,d,e);this.ue="html5";this.ba=new Audio;this.ba.crossOrigin="anonymous";this.ba.autoplay=!1;this.ba.preload="auto";this.Dc=this.Ec=null;this.ba.addEventListener("canplaythrough",()=>!0);this.Lc=this.ma().createGain();this.Gc=null;this.ba.addEventListener("canplay",()=>{this.Ec&&(this.Ec(),this.Dc=this.Ec=null);!this.Gc&&this.ba&&(this.Gc=this.ma().createMediaElementSource(this.ba),this.Gc.connect(this.Lc))});this.onended=null;this.ba.addEventListener("ended",
()=>{if(this.onended)this.onended()});this.ba.addEventListener("error",f=>{console.error(`[Construct] Audio '${this.Gb}' error: `,f);this.Dc&&(this.Dc(f),this.Dc=this.Ec=null)})}o(){bc(this.F,this);this.Lc.disconnect();this.Lc=null;this.Gc.disconnect();this.Gc=null;this.ba&&!this.ba.paused&&this.ba.pause();this.ba=this.onended=null;super.o()}ke(){return new Promise((a,b)=>{this.Ec=a;this.Dc=b;this.ba.src=this.Gb})}na(){return this.ba}Na(){return this.ba.duration}};"use strict";
async function ic(a){if(a.xb)return a.xb;var b=a.F.B;if("cordova"===b.G&&b.Af(a.Gb)&&b.od)a.xb=await b.Vc(a.Gb);else{b=await fetch(a.Gb);if(!b.ok)throw Error(`error fetching audio data: ${b.status} ${b.statusText}`);a.xb=await b.arrayBuffer()}}async function jc(a){if(a.Ra)return a.Ra;a.Ra=await ac(a.F,a.xb,a.Kh);a.xb=null}
self.Yg=class extends self.sf{constructor(a,b,c,d,e,f){super(a,b,c,d,e);this.ue="webaudio";this.Ra=this.xb=null;this.Kh=!!f}o(){bc(this.F,this);this.Ra=this.xb=null;super.o()}async ke(){try{await ic(this),await jc(this)}catch(a){console.error(`[Construct] Failed to load audio '${this.Gb}': `,a)}}Na(){return this.Ra?this.Ra.duration:0}};"use strict";let kc=0;
function Hb(a,b){b=!!b;a.yc!==b&&(a.yc=b,a.yc?(Jb(a,!1),a.P||(a.P=a.ma().createPanner(),a.P.panningModel=a.F.kg,a.P.distanceModel=a.F.Rf,a.P.refDistance=a.F.mg,a.P.maxDistance=a.F.jg,a.P.rolloffFactor=a.F.og),a.R.disconnect(),a.R.connect(a.P),a.P.connect(a.Ma())):(a.P.disconnect(),a.R.disconnect(),a.R.connect(a.Ma())))}
function Jb(a,b){b=!!b;a.pd!==b&&(a.pd=b,a.pd?(Hb(a,!1),a.Ka=a.ma().createStereoPanner(),a.R.disconnect(),a.R.connect(a.Ka),a.Ka.connect(a.Ma())):(a.Ka.disconnect(),a.Ka=null,a.R.disconnect(),a.R.connect(a.Ma())))}function Kb(a,b){a.pd&&a.ff!==b&&(a.Ka.pan.value=b,a.ff=b)}function gc(a,b){a.Hb=b;a.R.gain.cancelScheduledValues(0);a.Ob=-1;a.R.gain.value=a.Zd()}function hc(a,b){b=!!b;a.Qb!==b&&(a.Qb=b,a.bd())}
function Ib(a,b,c,d,e){if(a.yc){var f=a.Vb,g=a.Ub,h=Math.cos(e);e=Math.sin(e);if(f[0]!==b||f[1]!==c||f[2]!==d)f[0]=b,f[1]=c,f[2]=d,a.P.setPosition(...f);if(g[0]!==h||g[1]!==e||0!==g[2])g[0]=h,g[1]=e,g[2]=0,a.P.setOrientation(...g)}}function lc(a){return a.Qe?a.F.Ee:performance.now()/1E3}
self.tf=class{constructor(a,b,c){this.F=a;this.ha=b;this.Xa=c;this.cd=kc++;this.R=this.ma().createGain();this.R.connect(this.Ma());this.P=null;this.yc=!1;this.Vb=[0,0,0];this.Ub=[0,0,0];this.bb=[0,0,0];this.Ka=null;this.pd=!1;this.ff=0;this.W=!0;this.ra=this.cb=this.Z=!1;this.Hb=1;this.Qb=!1;this.Va=1;a=this.F.hf;this.Qe=1===a&&!this.rb()||2===a;this.Ob=this.Za=-1;this.qg=!1}o(){this.ha=this.F=null;this.P&&(this.P.disconnect(),this.P=null);this.Ka&&(this.Ka.disconnect(),this.Ka=null);this.R.disconnect();
this.R=null}ma(){return this.F.ma()}Ma(){return Zb(this.F,0<this.Xa.length?this.Xa[0]:"")}Yd(){return this.ha.Yd()}ic(){return this.ha.ic()}Xd(){return this.ha.Xd()}rb(){return this.ha.rb()}ea(){}Td(){}IsPlaying(){return!this.W&&!this.Z&&!this.ea()}Ib(){}Na(){return this.ha.Na()}Play(){}sb(){}kc(){}Xc(){}fa(a){-1!==this.Ob&&a>=this.Ob&&(this.Ob=-1,this.qg&&this.sb(),cc(this.F,"fade-ended",this.Xa,this.cd))}Zd(){const a=this.Hb;return isFinite(a)?a:0}Wc(){return this.F.Wc()}bd(){}de(){}wb(){}ce(){}ee(){}$d(){}hc(){var a=
this.cd,b=this.Xa,c=this.Na(),d=-1===this.Ob?this.Hb:this.R.gain.value,e=this.IsPlaying();if(this.P){var f=this.P;f={pos:this.Vb,orient:this.Ub,cia:f.coneInnerAngle,coa:f.coneOuterAngle,cog:f.coneOuterGain,uid:this.Za}}else f=null;return{aiid:a,tags:b,duration:c,volume:d,isPlaying:e,playbackTime:this.Ib(),playbackRate:this.Va,uid:this.Za,bufferOriginalUrl:this.Yd(),bufferUrl:"",bufferType:this.Xd(),isMusic:this.rb(),isLooping:this.ra,isMuted:this.Qb,resumePosition:this.$d(),pan:f,stereoPan:this.Ka?
this.ff:null}}le(a){var b=a.playbackRate;this.Va!==b&&(this.Va=b,this.wb());hc(this,a.isMuted)}};"use strict";
self.Tg=class extends self.tf{constructor(a,b,c){super(a,b,c);this.ha.Lc.connect(this.R);this.ha.onended=()=>this.oe()}o(){this.sb();this.ha.Lc.disconnect();super.o()}na(){return this.ha.na()}oe(){this.W=!0;this.Za=-1;cc(this.F,"ended",this.Xa,this.cd)}ea(){return this.na().ended}Td(){return this.W?!0:this.ea()}Ib(){let a=this.na().currentTime;this.ra||(a=Math.min(a,this.Na()));return a}Play(a,b,c){const d=this.na();1!==d.playbackRate&&(d.playbackRate=1);d.loop!==a&&(d.loop=a);gc(this,b);d.muted&&
(d.muted=!1);if(d.currentTime!==c)try{d.currentTime=c}catch(e){console.warn(`[Construct] Exception seeking audio '${this.ha.ic()}' to position '${c}': `,e)}this.F.tb(d);this.Z=this.W=!1;this.ra=a;this.Va=1}sb(){const a=this.na();a.paused||a.pause();this.F.Kb(a);this.W=!0;this.Z=!1;this.Za=-1}kc(){if(!(this.Z||this.W||this.ea())){var a=this.na();a.paused||a.pause();this.F.Kb(a);this.Z=!0}}Xc(){!this.Z||this.W||this.ea()||(this.F.tb(this.na()),this.Z=!1)}bd(){this.na().muted=this.Qb||this.Wc()}de(a){a=
!!a;this.ra!==a&&(this.ra=a,this.na().loop=a)}wb(){let a=this.Va;this.Qe&&(a*=this.F.Gd);try{this.na().playbackRate=a}catch(b){console.warn(`[Construct] Unable to set playback rate '${a}':`,b)}}ce(a){if(!this.W&&!this.ea())try{this.na().currentTime=a}catch(b){console.warn(`[Construct] Error seeking audio to '${a}': `,b)}}$d(){return this.Ib()}ee(a){a?this.IsPlaying()?(this.na().pause(),this.cb=!0):this.cb=!1:this.cb&&(this.F.tb(this.na()),this.cb=!1)}};"use strict";
function mc(a){a.C&&(a.C.onended=null,a.C.disconnect(),a.C.buffer=null);a.C=null;a.nc=null}
self.Zg=class extends self.tf{constructor(a,b,c){super(a,b,c);this.C=null;this.xd=d=>this.oe(d);this.He=!0;this.nc=null;this.ja=this.zd=this.Bd=0;this.Xe=1}o(){this.sb();mc(this);this.xd=null;super.o()}oe(a){this.Z||this.cb||a.target!==this.nc||(this.W=this.He=!0,this.Za=-1,mc(this),cc(this.F,"ended",this.Xa,this.cd))}ea(){return!this.W&&this.C&&this.C.loop||this.Z?!1:this.He}Td(){return!this.C||this.W?!0:this.ea()}Ib(){let a;a=this.Z?this.ja:this.zd+(lc(this)-this.Bd)*this.Va;this.ra||(a=Math.min(a,
this.Na()));return a}Play(a,b,c,d){this.Xe=1;gc(this,b);mc(this);this.C=this.ma().createBufferSource();this.C.buffer=this.ha.Ra;this.C.connect(this.R);this.nc=this.C;this.C.onended=this.xd;this.C.loop=a;this.C.start(d,c);this.Z=this.W=this.He=!1;this.ra=a;this.Va=1;this.Bd=lc(this);this.zd=c}sb(){if(this.C)try{this.C.stop(0)}catch(a){}this.W=!0;this.Z=!1;this.Za=-1}kc(){this.Z||this.W||this.ea()||(this.ja=this.Ib(),this.ra&&(this.ja%=this.Na()),this.Z=!0,this.C.stop(0))}Xc(){!this.Z||this.W||this.ea()||
(mc(this),this.C=this.ma().createBufferSource(),this.C.buffer=this.ha.Ra,this.C.connect(this.R),this.nc=this.C,this.C.onended=this.xd,this.C.loop=this.ra,gc(this,this.Hb),this.wb(),this.C.start(0,this.ja),this.Bd=lc(this),this.zd=this.ja,this.Z=!1)}Zd(){return super.Zd()*this.Xe}bd(){this.Xe=this.Qb||this.Wc()?0:1;gc(this,this.Hb)}de(a){a=!!a;this.ra!==a&&(this.ra=a,this.C&&(this.C.loop=a))}wb(){let a=this.Va;this.Qe&&(a*=this.F.Gd);this.C&&(this.C.playbackRate.value=a)}ce(a){this.W||this.ea()||(this.Z?
this.ja=a:(this.kc(),this.ja=a,this.Xc()))}$d(){return this.ja}ee(a){a?this.IsPlaying()?(this.cb=!0,this.ja=this.Ib(),this.ra&&(this.ja%=this.Na()),this.C.stop(0)):this.cb=!1:this.cb&&(mc(this),this.C=this.ma().createBufferSource(),this.C.buffer=this.ha.Ra,this.C.connect(this.R),this.nc=this.C,this.C.onended=this.xd,this.C.loop=this.ra,gc(this,this.Hb),this.wb(),this.C.start(0,this.ja),this.Bd=lc(this),this.zd=this.ja,this.cb=!1)}le(a){super.le(a);this.ja=a.resumePosition}};"use strict";
function K(a){return a.h.createGain()}function L(a,b,c,d,e){b.cancelScheduledValues(0);if(0===e)b.value=c;else switch(a=a.h.currentTime,e+=a,d){case 0:b.setValueAtTime(c,e);break;case 1:b.setValueAtTime(b.value,a);b.linearRampToValueAtTime(c,e);break;case 2:b.setValueAtTime(b.value,a),b.exponentialRampToValueAtTime(c,e)}}class M{constructor(a){this.F=a;this.h=a.ma();this.vc=-1;this.ka=this.eb="";this.A=null}o(){this.h=null}da(){}la(){}hc(){return{type:this.ka,tag:this.eb,params:this.A}}}
self.Lg=class extends M{constructor(a,b,c,d,e,f,g){super(a);this.ka="filter";this.A=[b,c,d,e,f,g];this.H=K(this);this.l=K(this);this.l.gain.value=g;this.j=K(this);this.j.gain.value=1-g;this.M=this.h.createBiquadFilter();this.M.type=b;this.M.frequency.value=c;this.M.detune.value=d;this.M.Q.value=e;this.M.gain.vlaue=f;this.H.connect(this.M);this.H.connect(this.j);this.M.connect(this.l)}o(){this.H.disconnect();this.M.disconnect();this.l.disconnect();this.j.disconnect();super.o()}la(a){this.l.disconnect();
this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[5]=b;L(this,this.l.gain,b,c,d);L(this,this.j.gain,1-b,c,d);break;case 1:this.A[1]=b;L(this,this.M.frequency,b,c,d);break;case 2:this.A[2]=b;L(this,this.M.detune,b,c,d);break;case 3:this.A[3]=b;L(this,this.M.Q,b,c,d);break;case 4:this.A[4]=b,L(this,this.M.gain,b,c,d)}}};
self.Jg=class extends M{constructor(a,b,c,d){super(a);this.ka="delay";this.A=[b,c,d];this.H=K(this);this.l=K(this);this.l.gain.value=d;this.j=K(this);this.j.gain.value=1-d;this.Fc=K(this);this.qa=this.h.createDelay(b);this.qa.delayTime.value=b;this.sc=K(this);this.sc.gain.value=c;this.H.connect(this.Fc);this.H.connect(this.j);this.Fc.connect(this.l);this.Fc.connect(this.qa);this.qa.connect(this.sc);this.sc.connect(this.Fc)}o(){this.H.disconnect();this.l.disconnect();this.j.disconnect();this.Fc.disconnect();
this.qa.disconnect();this.sc.disconnect();super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){const e=self.fc.wf;switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[2]=b;L(this,this.l.gain,b,c,d);L(this,this.j.gain,1-b,c,d);break;case 4:this.A[1]=e(b);L(this,this.sc.gain,e(b),c,d);break;case 5:this.A[0]=b,L(this,this.qa.delayTime,b,c,d)}}};
self.Ig=class extends M{constructor(a,b,c,d){super(a);this.ka="convolution";this.A=[c,d];this.Of=this.Nf="";this.H=K(this);this.l=K(this);this.l.gain.value=d;this.j=K(this);this.j.gain.value=1-d;this.qc=this.h.createConvolver();this.qc.normalize=c;this.qc.buffer=b;this.H.connect(this.qc);this.H.connect(this.j);this.qc.connect(this.l)}o(){this.H.disconnect();this.qc.disconnect();this.l.disconnect();this.j.disconnect();super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,
b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this.A[1]=b,L(this,this.l.gain,b,c,d),L(this,this.j.gain,1-b,c,d)}}hc(){const a=super.hc();a.bufferOriginalUrl=this.Nf;a.bufferUrl="";a.bufferType=this.Of;return a}};
self.Mg=class extends M{constructor(a,b,c,d,e,f){super(a);this.ka="flanger";this.A=[b,c,d,e,f];this.H=K(this);this.j=K(this);this.j.gain.value=1-f/2;this.l=K(this);this.l.gain.value=f/2;this.uc=K(this);this.uc.gain.value=e;this.qa=this.h.createDelay(b+c);this.qa.delayTime.value=b;this.J=this.h.createOscillator();this.J.frequency.value=d;this.$=K(this);this.$.gain.value=c;this.H.connect(this.qa);this.H.connect(this.j);this.qa.connect(this.l);this.qa.connect(this.uc);this.uc.connect(this.qa);this.J.connect(this.$);
this.$.connect(this.qa.delayTime);this.J.start(0)}o(){this.J.stop(0);this.H.disconnect();this.qa.disconnect();this.J.disconnect();this.$.disconnect();this.j.disconnect();this.l.disconnect();this.uc.disconnect();super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[4]=b;L(this,this.l.gain,b/2,c,d);L(this,this.j.gain,1-b/2,c,d);break;case 6:this.A[1]=b/1E3;L(this,this.$.gain,
b/1E3,c,d);break;case 7:this.A[2]=b;L(this,this.J.frequency,b,c,d);break;case 8:this.A[3]=b/100,L(this,this.uc.gain,b/100,c,d)}}};
self.Og=class extends M{constructor(a,b,c,d,e,f,g){super(a);this.ka="phaser";this.A=[b,c,d,e,f,g];this.H=K(this);this.j=K(this);this.j.gain.value=1-g/2;this.l=K(this);this.l.gain.value=g/2;this.M=this.h.createBiquadFilter();this.M.type="allpass";this.M.frequency.value=b;this.M.detune.value=c;this.M.Q.value=d;this.J=this.h.createOscillator();this.J.frequency.value=f;this.$=K(this);this.$.gain.value=e;this.H.connect(this.M);this.H.connect(this.j);this.M.connect(this.l);this.J.connect(this.$);this.$.connect(this.M.frequency);
this.J.start(0)}o(){this.J.stop(0);this.H.disconnect();this.M.disconnect();this.J.disconnect();this.$.disconnect();this.j.disconnect();this.l.disconnect();super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[5]=b;L(this,this.l.gain,b/2,c,d);L(this,this.j.gain,1-b/2,c,d);break;case 1:this.A[0]=b;L(this,this.M.frequency,b,c,d);break;case 2:this.A[1]=b;L(this,this.M.detune,b,
c,d);break;case 3:this.A[2]=b;L(this,this.M.Q,b,c,d);break;case 6:this.A[3]=b;L(this,this.$.gain,b,c,d);break;case 7:this.A[4]=b,L(this,this.J.frequency,b,c,d)}}};self.Ng=class extends M{constructor(a,b){super(a);this.ka="gain";this.A=[b];this.v=K(this);this.v.gain.value=b}o(){this.v.disconnect();super.o()}la(a){this.v.disconnect();this.v.connect(a)}da(){return this.v}ua(a,b,c,d){const e=self.fc.wf;switch(a){case 4:this.A[0]=e(b),L(this,this.v.gain,e(b),c,d)}}};
self.Qg=class extends M{constructor(a,b){super(a);this.ka="stereopan";this.A=[b];this.v=this.h.createStereoPanner();this.v.pan.value=b}o(){this.v.disconnect();super.o()}la(a){this.v.disconnect();this.v.connect(a)}da(){return this.v}ua(a,b,c,d){b=Math.min(Math.max(b/100,-1),1);switch(a){case 9:this.A[0]=b,L(this,this.v.pan,b,c,d)}}};
self.Rg=class extends M{constructor(a,b,c){super(a);this.ka="tremolo";this.A=[b,c];this.v=K(this);this.v.gain.value=1-c/2;this.J=this.h.createOscillator();this.J.frequency.value=b;this.$=K(this);this.$.gain.value=c/2;this.J.connect(this.$);this.$.connect(this.v.gain);this.J.start(0)}o(){this.J.stop(0);this.J.disconnect();this.$.disconnect();this.v.disconnect();super.o()}la(a){this.v.disconnect();this.v.connect(a)}da(){return this.v}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[1]=
b;L(this,this.v.gain,1-b/2,c,d);L(this,this.$.gain,b/2,c,d);break;case 7:this.A[0]=b,L(this,this.J.frequency,b,c,d)}}};
self.Pg=class extends M{constructor(a,b,c){super(a);this.ka="ringmod";this.A=[b,c];this.H=K(this);this.l=K(this);this.l.gain.value=c;this.j=K(this);this.j.gain.value=1-c;this.Pc=K(this);this.Pc.gain.value=0;this.J=this.h.createOscillator();this.J.frequency.value=b;this.J.connect(this.Pc.gain);this.J.start(0);this.H.connect(this.Pc);this.H.connect(this.j);this.Pc.connect(this.l)}o(){this.J.stop(0);this.J.disconnect();this.Pc.disconnect();this.H.disconnect();this.l.disconnect();this.j.disconnect();
super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this.A[1]=b;L(this,this.l.gain,b,c,d);L(this,this.j.gain,1-b,c,d);break;case 7:this.A[0]=b,L(this,this.J.frequency,b,c,d)}}};
self.Kg=class extends M{constructor(a,b,c,d,e,f){super(a);this.ka="distortion";this.A=[b,c,d,e,f];this.H=K(this);this.Dd=K(this);this.Cd=K(this);a=d;.01>a&&(a=.01);this.Dd.gain.value=a;this.Cd.gain.value=Math.pow(1/a,.6)*e;this.l=K(this);this.l.gain.value=f;this.j=K(this);this.j.gain.value=1-f;this.Kd=this.h.createWaveShaper();this.xe=new Float32Array(65536);for(e=0;32768>e;++e)f=e/32768,a=1.05*c*b-b,d=0>f?-f:f,d<b?a=d:(d=1-Math.exp(-(1/a)*(d-b)),a=b+a*d),f=a*(0>f?-1:1),this.xe[32768+e]=f,this.xe[32768-
e-1]=-f;this.Kd.curve=this.xe;this.H.connect(this.Dd);this.H.connect(this.j);this.Dd.connect(this.Kd);this.Kd.connect(this.Cd);this.Cd.connect(this.l)}o(){this.H.disconnect();this.Dd.disconnect();this.Kd.disconnect();this.Cd.disconnect();this.l.disconnect();this.j.disconnect();super.o()}la(a){this.l.disconnect();this.l.connect(a);this.j.disconnect();this.j.connect(a)}da(){return this.H}ua(a,b,c,d){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this.A[4]=b,L(this,this.l.gain,b,c,d),L(this,this.j.gain,
1-b,c,d)}}};self.Hg=class extends M{constructor(a,b,c,d,e,f){super(a);this.ka="compressor";this.A=[b,c,d,e,f];this.v=this.h.createDynamicsCompressor();this.v.threshold.value=b;this.v.knee.value=c;this.v.ratio.value=d;this.v.attack.value=e;this.v.release.value=f}o(){this.v.disconnect();super.o()}la(a){this.v.disconnect();this.v.connect(a)}da(){return this.v}ua(){}};
self.Gg=class extends M{constructor(a,b,c){super(a);this.ka="analyser";this.A=[b,c];this.v=this.h.createAnalyser();this.v.fftSize=b;this.v.smoothingTimeConstant=c;this.Wf=new Float32Array(this.v.frequencyBinCount);this.pg=new Uint8Array(b);this.ng=this.Wb=0;a=this.F;a.Mb.add(this);Nb(a)}o(){this.F.Mb.delete(this);this.v.disconnect();super.o()}fa(){this.v.getFloatFrequencyData(this.Wf);this.v.getByteTimeDomainData(this.pg);const a=this.v.fftSize;let b=this.Wb=0;for(var c=0;c<a;++c){let d=(this.pg[c]-
128)/128;0>d&&(d=-d);this.Wb<d&&(this.Wb=d);b+=d*d}c=self.fc.hh;this.Wb=c(this.Wb);this.ng=c(Math.sqrt(b/a))}la(a){this.v.disconnect();this.v.connect(a)}da(){return this.v}ua(){}};"use strict";function N(a){a.stopPropagation()}
self.Ea.hb(class extends self.vf{constructor(a){super(a,"sliderbar")}Ud(a,b){const c=document.createElement("input");c.type="range";c.style.position="absolute";c.style.userSelect="none";c.style.webkitUserSelect="none";c.addEventListener("pointerdown",N);c.addEventListener("pointermove",N);c.addEventListener("pointerrawupdate",N);c.addEventListener("pointerup",N);c.addEventListener("mousedown",N);c.addEventListener("mouseup",N);c.addEventListener("keydown",N);c.addEventListener("keyup",N);c.addEventListener("click",
()=>ka(this,"click",a));c.addEventListener("change",()=>ha(this,"change",a,{value:parseFloat(c.value)}));c.addEventListener("input",()=>ha(this,"input",a,{value:parseFloat(c.value)}));b.id&&(c.id=b.id);b.className&&(c.className=b.className);this.mc(c,b);return c}mc(a,b){a.max=b.max;a.min=b.min;a.step=b.step;a.value=b.value;a.disabled=!b.isEnabled;a.title=b.title}});"use strict";function oc(a){a.stopPropagation()}function pc(a){const b=document.createElement("option");b.text=a;return b}
function qc(a){const b=a.selectedIndex,c=[];for(let d=0,e=a.length;d<e;++d)a.options[d].selected&&c.push(d);return{selectedIndex:b,selectedIndices:c}}
self.Ea.hb(class extends self.vf{constructor(a){super(a,"list");p(this,"set-selected-index",(b,c)=>{b.selectedIndex=c.selectedIndex});p(this,"add-item",(b,c)=>{const d=c.index;c=pc(c.text);0>d?b.add(c):b.add(c,d)});p(this,"remove-item",(b,c)=>{b.remove(c.index)});p(this,"set-item",(b,c)=>{b.options[c.index].text=c.text});p(this,"clear",b=>{b.innerHTML=""});p(this,"load-state",(b,c)=>this.pe(b,c))}Ud(a,b){const c=b.isDropdown,d=b.isMultiSelect,e=b.items,f=document.createElement("select");f.style.position=
"absolute";f.style.userSelect="none";f.style.webkitUserSelect="none";f.multiple=d;c||(f.size=2);for(const g of e)f.add(pc(g));f.addEventListener("pointerdown",oc);f.addEventListener("pointermove",oc);f.addEventListener("pointerrawupdate",oc);f.addEventListener("pointerup",oc);f.addEventListener("mousedown",oc);f.addEventListener("mouseup",oc);f.addEventListener("click",g=>{g.stopPropagation();ka(this,"click",a,qc(f))});f.addEventListener("dblclick",g=>{g.stopPropagation();ka(this,"dblclick",a,qc(f))});
f.addEventListener("change",()=>ha(this,"change",a,qc(f)));b.id&&(f.id=b.id);b.className&&(f.className=b.className);this.mc(f,b);return f}mc(a,b){a.title=b.title;a.disabled=!b.isEnabled;a.multiple=!!b.isMultiSelect}pe(a,b){a.innerHTML="";for(const c of b.items)a.add(pc(c));a.selectedIndex=b.selectedIndex;for(const c of b.selectedIndices)if(b=a.options[c])b.selected=!0}});"use strict";const rc=[],sc=2*Math.PI;function tc(a){a%=sc;0>a&&(a+=sc);return a}
function uc(a,b){switch(a.nb){case 0:return b;case 1:return Math.fround(b);case 2:return 2===a.wc&&(b=tc(b),b/=Math.PI,b=32767*(b-1)),a=b|0,-32768>a?-32768:32767<a?32767:a;case 3:return 2===a.wc&&(b=tc(b),b/=sc,b*=255),a=b|0,0>a?0:255<a?255:a;default:return b}}function vc(a,b,c,d){switch(a.nb){case 0:b.setFloat64(c,d);c+=8;break;case 1:b.setFloat32(c,d);c+=4;break;case 2:b.setInt16(c,d);c+=2;break;case 3:b.setUint8(c,d);c+=1;break;default:b.setFloat32(c,d),c+=4}return c}
function wc(a,b){if(2!==a.wc)return b;2===a.nb?b=(b/32767+1)*Math.PI:3===a.nb&&(b=b/255*sc);return b}function xc(a,b,c,d,e){switch(a){case 0:return e?c:b;case 1:return b+d*(c-b);case 2:return b===c?a=0:(a=Math.sin(b)*Math.sin(c)+Math.cos(b)*Math.cos(c),a=1<=a?0:-1>=a?Math.PI:Math.acos(a)),0>=Math.cos(c)*Math.sin(b)-Math.sin(c)*Math.cos(b)?tc(b+a*d):tc(b-a*d);default:return e?c:b}}
class yc{constructor(a,b,c,d,e,f){this.vc=a;this.wc=b;this.nb=c;this.eb=d;this.Jd=e;this.Pf=f}Jb(){return{tag:this.eb,interp:this.wc,userData:this.Jd,cvt:this.Pf}}ib(){return this.wc}}class zc{constructor(a,b){this.timestamp=a;this.data=b}}
class Ac{constructor(a,b,c){this.sa=a;this.g=a.g;this.I=b;this.X=c;this.rc=[];this.rc.length=this.sa.za.length;this.Ue=this.qd=0;this.Me=this.Hd=!1;this.aa=[];this.O=this.D=this.Ja=null}Jb(){var a=[];for(let c=0,d=this.sa.za.length;c<d;++c)a.push(this.ib(this.sa.Fd,c));a={id:this.I,nid:this.X,isTimedOut:0===this.aa.length?!1:this.aa[this.aa.length-1].timestamp<this.sa.Fd-3E3,interpValues:a,latestUpdate:null};const b=0===this.aa.length?null:this.aa[this.aa.length-1];b&&(a.latestUpdate={timestamp:b.timestamp,
data:b.data});return a}fe(a,b){a=a.netValues;var c=this.sa.za;const d=c.length;this.Hd=!1;for(let e=0;e<d;++e){const f=uc(c[e],a[e]);this.rc[e]!==f&&(this.rc[e]=f,this.qd=b,this.sa.qd=b)}a=b-this.qd;b-=this.Ue;c=this.sa.Mf;(this.Hd=100>a&&0===c?!0:1E3>a&&1>=c?95<=b:495<=b)&&this.sa.Kc++}ge(a,b,c){const d=this.sa.za;this.Ue=c;a.setUint16(b,this.X);b+=2;for(let e=0,f=this.rc.length;e<f;++e)b=vc(d[e],a,b,this.rc[e]);return b}Rd(a,b){for(let c=0,d=this.aa.length;c<d;++c){const e=this.aa[c];if(e.timestamp===
a)return;if(e.timestamp>a){this.aa.splice(c,0,new zc(a,b));return}}this.aa.push(new zc(a,b))}fa(){for(;2<this.aa.length&&this.aa[0]!==this.Ja&&this.aa[0]!==this.D&&this.aa[0]!==this.O;)this.aa.shift();const a=this.sa.Fd;if(!(this.O&&this.O.timestamp>a&&this.D&&this.D.timestamp<a)){this.O=null;for(let b=0,c=this.aa.length;b<c;++b){const d=this.aa[b];if(d.timestamp<=a){if(!this.D||d.timestamp>this.D.timestamp)this.Ja=this.D,this.D=d}else{this.O=d;break}}}}ib(a,b){if(!this.O&&!this.D)return 0;if(this.O&&
!this.D)return this.O.data[b];const c=this.sa.za;let d,e,f;if(!this.O&&this.D){if(this.Ja){var g=this.Ja.timestamp;d=this.Ja.data[b];e=this.D.timestamp;f=this.D.data[b];a>this.D.timestamp+this.sa.ld&&(a=this.D.timestamp+this.sa.ld);g=g===e?0:(a-g)/(e-g);return xc(c[b].ib(),d,f,g,!0)}return this.D.data[b]}g=this.D.timestamp;d=this.D.data[b];e=this.O.timestamp;f=this.O.data[b];return xc(c[b].ib(),d,f,g===e?0:(a-g)/(e-g),!1)}}
function Bc(a,b,c,d,e,f){b=new yc(a.za.length,b,c,d,e,f);switch(c){case 0:a.Ua+=8;break;case 1:a.Ua+=4;break;case 2:a.Ua+=2;break;case 3:a.Ua+=1}a.za.push(b)}function Cc(a,b){const c=b.I,d=b.X;a.g.s()&&!a.Pb&&a.gd.push(d);a.Db.delete(c);a.Jc.delete(d);a.bc.delete(d);b=a.Ia.indexOf(b);-1<b&&a.Ia.splice(b,1)}function Dc(a,b){(b=a.Jc.get(b))&&Cc(a,b)}function Ec(a){return{roId:a.Qc,sid:a.Rc,netValues:a.za.map(b=>b.Jb())}}
class Fc{constructor(a,b,c,d){this.g=a;this.Qc=b;this.Rc=c;this.X=this.g.Lh++;this.Mf=d;this.Jd={};this.Ua=0;this.ld=250;switch(this.Mf){case 1:this.ld=500;break;case 2:this.ld=2500}this.za=[];this.Ia=[];this.Db=new Map;this.bc=new Set;this.Kc=this.Ue=this.qd=this.Ic=0;this.Pb=!1;this.gd=[];this.Jc=new Map;this.Fd=0;a=this.g;a.Fa.push(this);a.Oc.set(this.Qc,this);a.Zb.set(this.X,this)}vb(a){this.X=a}Rd(a,b,c){{let d=this.Jc.get(b);d||(d=new Ac(this,-1,b),this.Jc.set(b,d),this.Ia.push(d));b=d}b.Rd(a,
c)}fa(){this.Fd=Gc(this.g);for(const a of this.Ia)a.fa()}fe(a,b){this.Kc=0;for(var c of this.Ia)c.Me=!1;for(let f=0,g=a.length;f<g;++f){c=a[f];var d=c.uid;var e=this.Db.get(d);if(!e){e=d;do this.Ic++,65535<this.Ic&&(this.Ic=0);while(this.bc.has(this.Ic));const h=this.Ic;this.bc.add(h);e=new Ac(this,e,h);this.Db.set(d,e);this.Ia.push(e)}d=e;d.Me=!0;d.fe(c,b)}for(const f of this.Ia)f.Me||rc.push(f);for(const f of rc)Cc(this,f);rc.length=0}ge(a,b,c){a.setUint16(b,this.X);b+=2;let d=0;this.Pb&&(d=1);
a.setUint8(b,d);b+=1;a.setUint16(b,this.Kc);b+=2;a.setUint16(b,this.Ua);b+=2;for(const e of this.Ia)e.Hd&&(b=e.ge(a,b,c));return b}be(a){(a=this.Db.get(a))&&Cc(this,a)}Jb(){return{hasOverriddenNids:this.Pb,netValues:this.za.map(a=>a.Jb()),netInstances:this.Ia.map(a=>a.Jb())}}}self.Vg=yc;self.Ug=zc;self.Xg=Fc;"use strict";const Hc=self.Ug,Ic=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;
function Jc(a){if(a)try{a.close()}catch(b){}}const P=[];function Kc(a){return new Promise(b=>setTimeout(b,a))}async function Lc(a){if(a.af.length&&!(a.te>=a.Jh)){a.te++;var b=a.af.shift();try{const c=await b.Th();b.resolve(c)}catch(c){b.reject(c)}a.te--;Lc(a)}}function Mc(a,b){return new Promise((c,d)=>{a.af.push({Th:b,resolve:c,reject:d});Lc(a)})}class Nc{constructor(){this.Jh=1;this.af=[];this.te=0}}
async function Oc(a,b,c){const d=Pc(a,b,c.data);c=d;"o"===b&&(c=Mc(a.Oh,()=>d));(c=await c)&&Qc(a,b,c)}function Q(a,b,c){if(!a.cc){a.cc=!0;Rc(a,b);R(a,"o",JSON.stringify({c:"disconnect",r:b,k:!!c}));var d=a.yb,e=a.zb,f=a.Ab,g=a.L;setTimeout(()=>{Jc(d);Jc(e);Jc(f);Jc(g)},0);a.yb=null;a.zb=null;a.Ab=null;a.L=null;a.xc=!1;a.zc=!1;a.Ac=!1;Sc(a.g,a)}}
function Tc(a,b,c){b.binaryType="arraybuffer";b.onopen=()=>{"o"===c?a.xc=!0:"r"===c?a.zc=!0:"u"===c&&(a.Ac=!0);if(!a.kb&&a.zc&&a.Ac&&a.xc){a.Se=performance.now();if(a.g.s()){Uc(a.g,"o",JSON.stringify({c:"j",i:a.I,n:a.X,a:a.ga}),0,a);var d=R,e=JSON,f=e.stringify,g=a.g.S.X,h=a.X,l=a.g.Ga,v=a.g.Mc,q=a.g;var D={};for(const [t,u]of q.Zb.entries()){q=u.Rc;const F=[];for(var y of u.za){const I={tag:y.eb,precision:y.nb,interp:y.ib(),clientvaluetag:y.Pf};"undefined"!==typeof y.Jd&&(I.userdata=y.Jd);F.push(I)}D[q]=
{nid:t,nvs:F}}y=a.g;q=[];for(const t of y.Pa)q.push({tag:t.eb,precision:t.nb,interp:t.ib()});d(a,"o",f.call(e,{c:"hi",hn:g,n:h,d:l,u:v,objs:D,cvs:q,comp:Vc}));for(const t of a.g.Qa)!t.s()&&t!==a&&t.kb&&!t.Cb&&R(a,"o",JSON.stringify({c:"j",i:t.I,n:t.X,a:t.ga}))}else a.Ge=!0,a.s()&&Wc(a,performance.now(),!0),R(a,"o",JSON.stringify({c:"comp",comp:Vc}));Xc(a.g,a);a.kb=!0;a.Cb=!1}};b.onmessage=d=>{Oc(a,c,d)};b.onerror=d=>{console.error("Peer '"+a.I+"' datachannel '"+c+"' error: ",d);T(a,d);a.g.s()&&!a.s()&&
Q(a,"network error")};b.onclose=()=>{Q(a,"disconnect")}}
function Yc(a){if(a!==a.g.N){var b=a.g.s();a.xc=!1;a.zc=!1;a.Ac=!1;a.kb=!1;a.Cb=!1;a.Qf=performance.now();a.L=new Ic({iceServers:a.g.Ke});a.L.onicecandidate=d=>{d.candidate&&U(a.g,{message:"icecandidate",toclientid:a.I,icecandidate:d.candidate})};a.L.onsignalingstatechange=()=>{a.L&&"closed"===a.L.signalingState&&Q(a,"disconnect")};a.L.oniceconnectionstatechange=()=>{a.L&&("failed"!==a.L.iceConnectionState&&"closed"!==a.L.iceConnectionState||Q(a,"disconnect"))};a.L.onconnectionstatechange=()=>{if(a.L){var d=
a.L.connectionState;"failed"!==d&&"closed"!==d||Q(a,"disconnect")}};var c=`c3mp_${a.g.Ce}_${a.g.De}_${a.g.T}`;b?(a.X=Zc(a.g),a.yb=a.L.createDataChannel("o",{ordered:!0,protocol:c}),Tc(a,a.yb,"o"),a.zb=a.L.createDataChannel("r",{ordered:!1,protocol:c}),Tc(a,a.zb,"r"),a.Ab=a.L.createDataChannel("u",{ordered:!1,maxRetransmits:0,protocol:c}),Tc(a,a.Ab,"u"),a.L.createOffer().then(d=>{a.L.setLocalDescription(d);U(a.g,{message:"offer",toclientid:a.I,offer:d})}).catch(d=>{console.error("Host error creating offer for peer '"+
a.I+"': ",d);T(a,"could not create offer for peer")})):a.L.ondatachannel=d=>{if(d.channel.protocol!==c)console.error("Unexpected datachannel protocol '"+d.channel.protocol+"', should be '"+c+"'"),T(a,"unexpected datachannel protocol '"+d.channel.protocol+"', should be '"+c+"'"),a.cc||(Q(a,"datachannel protocol error"),k(a.g,"peer-kicked"));else{var e=d.channel.label;"o"===e?a.yb=d.channel:"r"===e?a.zb=d.channel:"u"===e?a.Ab=d.channel:(console.error("Unknown datachannel label: "+d.channel.label),T(a,
"unknown datachannel label '"+d.channel.label+"'"));Tc(a,d.channel,e)}}}}async function $c(a,b){if(a.L)try{await a.L.addIceCandidate(b)}catch(c){console.warn("[Multiplayer] Error adding ICE candidate: ",c)}}async function R(a,b,c,d=0){ad(a.g,c);const e=bd(a,b,c,d);c=e;"o"===b&&(c=Mc(a.Ph,()=>e));(c=await c)&&cd(a,b,c)}
function Wc(a,b,c){a.cc||(!c&&(!a.kb||a.Cb)&&a.L&&25E3<b-a.Qf?(console.warn("Timed out '"+a.ga+"', could not establish connection after 25sec"),Q(a,"timeout")):!c&&a.kb&&!a.Cb&&2E4<b-a.Se?(console.warn("Timed out '"+a.ga+"', not heard from for 20sec"),Q(a,"timeout")):(a.bg=b,a.we=!0,a.Te++,R(a,"u","ping:"+a.Te)))}function Rc(a,b){!a.Cb&&a.kb&&(a.ne(b),a.Cb=!0,a.kb=!1)}function dd(a,b){const c=Vc;for(const d of b)c.includes(d)&&a.ve.push(d)}
async function ed(a,b){if(0===a.ve.length)return{Ld:0,data:b};const c=new Blob([b]);if(64>c.size)return{Ld:0,data:b};a=a.ve[0];var d=new CompressionStream(a);d=c.stream().pipeThrough(d);d=await (new Response(d)).arrayBuffer();if(d.byteLength>=c.size)return{Ld:0,data:b};b=V.Sd.indexOf(a);if(0>b)throw Error("invalid compression type");return{Ld:b,data:d}}
async function bd(a,b,c,d=0){var e="string"===typeof c;const {Ld:f,data:g}=await ed(a,c);c=g;g instanceof ArrayBuffer&&(0!==f&&(d|=f<<4,e&&(d|=V.yf)),c=new ArrayBuffer(g.byteLength+8),e=new DataView(c),e.setUint32(0,V.Bf),e.setUint32(4,d),(new Uint8Array(c,8)).set(new Uint8Array(g)));a.g.ta.pf++;d=a.g;d.ta.Nd+=fd(c);d=a.g.df;e=a.g.cf;a=a.g.ef;if(0<d&&"u"===b&&Math.random()<d)return null;if(0!==e||0!==a){let h=1;"u"!==b&&Math.random()<d&&(h=3);await Kc((e+Math.random()*a)*h)}return c}
function cd(a,b,c){try{"o"===b?a.xc&&a.yb&&a.yb.send(c):"r"===b?a.zc&&a.zb&&a.zb.send(c):"u"===b&&a.Ac&&a.Ab&&a.Ab.send(c)}catch(d){a.cc||(a.g.s()?"o"===b||"r"===b?("string"===typeof c?(console.error("Error sending "+c.length+"-char string on '"+b+"' to '"+a.ga+"', host kicking: ",d),console.log("String that failed to send from previous error was: "+c)):console.error("Error sending "+(c.length||c.byteLength)+"-byte binary on '"+b+"' to '"+a.ga+"', host kicking: ",d),Q(a,"network error")):(a.kd++,
10<=a.kd&&("string"===typeof c?(console.error("Too many errors ("+a.kd+") sending data on '"+b+"' to '"+a.ga+"', kicking; last error was for sending "+c.length+"-char string: ",d),console.log("String that failed to send from previous error was: "+c)):console.error("Too many errors ("+a.kd+") sending data on '"+b+"' to '"+a.ga+"', kicking; last error was for sending "+(c.length||c.byteLength)+"-byte binary: ",d),Q(a,"network error"))):console.error("Error sending data on '"+b+"': ",d))}}
function gd(a,b){if(a.we){var c=b.indexOf(":");if(-1<c){if(parseFloat(b.substr(c+1))===a.Te){c=performance.now();a.we=!1;var d=(c-a.bg)/2;a.rd.push(d);10<a.rd.length&&a.rd.shift();P.push(...a.rd);P.sort((h,l)=>h-l);a.lg=P[P.length-1]-P[0];var e=0,f=P.length;4<=P.length&&6>=P.length?(++e,--f):6<P.length&&(e+=2,f-=2);var g=0;for(let h=e;h<f;++h)g+=P[h];a.sd=g/(f-e);P.length=0;a.g.s()||(e=b.indexOf("/"),-1<e?(b=parseFloat(b.substr(e+1)),isFinite(b)?hd(a.g,b,c,d,a.sd):console.warn("Invalid host time from pong response")):
console.warn("Cannot parse off host time from pong response"))}}else console.warn("Cannot parse off ping ID from pong")}}async function Pc(a,b,c){a.g.ta.lf++;var d=a.g;d.ta.Md+=fd(c);d=a.g.df;const e=a.g.cf;a=a.g.ef;if(0<d&&"u"===b&&Math.random()<d)return null;if(0!==e||0!==a){let f=1;"u"!==b&&Math.random()<d&&(f=3);await Kc(e*f+Math.random()*a*f)}return c instanceof ArrayBuffer?await id(c):c}
function Qc(a,b,c){if(!a.cc)if(a.Se=performance.now(),"string"===typeof c){var d=a.g;d.ta.ec+=fd(c);if(!(""===c.trim()||4>c.length))if(d=c.substr(0,4),"ping"===d)d="pong:"+c.substr(5),a.g.s()&&(d=d+"/"+Math.round(performance.now()).toString()),R(a,"u",d);else if("pong"===d)gd(a,c);else{try{var e=JSON.parse(c)}catch(m){T(a,m);a.g.s()?(console.error("Error parsing message as JSON for peer '"+a.I+"', host kicking: ",m),Q(a,"data error")):console.error("Error parsing message as JSON for peer '"+a.I+"': ",
m);console.log("String that failed to parse from previous error: "+c);return}if(e)try{if(e.c&&"m"!==e.c){d=e;let m,G;switch(d.c){case "disconnect":d.k&&k(a.g,"peer-kicked");G=!a.g.s()&&!a.s();Q(a,d.r);G&&jd(a.g);break;case "hi":if(!a.g.s()){a.g.S.vb(d.hn);a.g.N.vb(d.n);a.g.Ga=d.d;a.g.Mc=d.u;var f=a.g,g=d.objs;f.Zb.clear();for(const x of f.Fa)if(g.hasOwnProperty(x.Rc.toString())){const S=g[x.Rc.toString()];x.vb(S.nid);f.Zb.set(S.nid,x);var h=S.nvs;x.za.length=0;x.Ua=0;for(const E of h)Bc(x,E.interp,
E.precision,E.tag,E.userdata,E.clientvaluetag)}else console.warn("Could not map object SID '"+x.Rc+"' - host did not send NID for it"),x.vb(-1);var l=a.g,v=d.cvs;l.ed.clear();l.Pa.length=0;for(let x=0,S=v.length;x<S;++x){const E=v[x],Y=new kd(x,E.interp,E.precision,E.tag,null);l.ed.set(Y.eb,Y);l.Pa.push(Y)}l.bf=!0;d.hasOwnProperty("comp")&&dd(a,d.comp)}break;case "comp":dd(a,d.comp);break;case "j":a.g.s()||(m=new V(a.g,d.i,d.a),m.vb(d.n),Xc(a.g,m));break;case "l":!a.g.s()&&(m=a.g.Aa.get(d.i)||null)&&
(m===m.g.N||ld(a.g,m,d.r),Q(m,d.r));break;default:console.error("Unknown control message from peer '"+a.I+"': "+d.c),T(a,"unknown control message '"+d.c+"'")}}else{var q=a.g;d=e;const m=d.f||a.I;k(q,"peer-message",{tag:d.t,fromId:m,fromAlias:md(q,m),transmissionMode:b,content:d.m,contentMode:d.cm||"e"})}}catch(m){T(a,m),a.g.s()?(console.error("Error handling message for peer '"+a.I+"', host kicking: ",m),Q(a,"data error")):console.error("Error handling message for peer '"+a.I+"': ",m)}}}else{f=a.g;
f.ta.ec+=fd(c.data);!a.Ge&&a.g.s()&&"u"===b&&(a.Ge=!0,f=a.g,f.xa&&f.s()&&U(f,{message:"confirm-peer",id:a.I}));try{var D=c.data,y=c.offset,t=c.flags;if(0===(t&V.Wd))if(d=new DataView(D,y),a.g.s()){var u=0,F=d.getFloat64(u);u+=8;F+=a.sd;if(!(3E3<=Math.abs(F-performance.now()))){var I=d.getUint8(u);u+=1;var w=[],X=a.g.Pa;for(var O=0;O<I;++O)if(O>=X.length)w.push(0);else{var ia=X[O],C=void 0;switch(ia.nb){case 0:C=d.getFloat64(u);u+=8;break;case 1:C=d.getFloat32(u);u+=4;break;case 2:C=wc(ia,d.getInt16(u));
u+=2;break;case 3:C=wc(ia,d.getUint8(u));u+=1;break;default:C=d.getFloat32(u),u+=4}w.push(C)}a:{d=F;for(let m=0,G=a.va.length;m<G;++m){var A=a.va[m];if(A.timestamp===d)break a;if(A.timestamp>d){a.va.splice(m,0,new Hc(d,w));break a}}a.va.push(new Hc(d,w))}}}else if(0===(t&V.xf))for(A=0,w=d.getFloat64(A),A+=8,u=d.getUint16(A),A+=2,b=0;b<u;++b){O=d.getUint16(A);A+=2;const m=d.getUint8(A);A+=1;I=null;X=0;const G=a.g.Zb.get(O)||null;G?(I=G.za,X=I.length,1===m&&(G.Pb=!0)):console.warn("Don't know which object corresponds to NID "+
O);const x=d.getUint16(A);A+=2;const S=d.getUint16(A);A+=2;for(F=0;F<x;++F){const E=d.getUint16(A);A+=2;if(G){ia=[];C=A;for(var ua=0;ua<X;++ua){const Y=I[ua];let ja;switch(Y.nb){case 0:ja=d.getFloat64(C);C+=8;break;case 1:ja=d.getFloat32(C);C+=4;break;case 2:ja=wc(Y,d.getInt16(C));C+=2;break;case 3:ja=wc(Y,d.getUint8(C));C+=1;break;default:ja=d.getFloat32(C),C+=4}ia.push(ja)}G.Rd(w,E,ia)}A+=S}}else{w=0;ua=d.getFloat64(w);w+=8;const m=d.getUint16(w);w+=2;for(u=0;u<m;++u){const G=d.getUint16(w);w+=
2;const x=a.g.Zb.get(G)||null;x||console.warn("Don't know which object corresponds to NID "+G);const S=d.getUint16(w);w+=2;for(O=0;O<S;++O){const E=d.getUint16(w);w+=2;x&&!x.Pb&&(k(a.g,"instance-destroyed",{roId:x.Qc,nid:E,timestamp:ua}),Dc(x,E))}}}else{var nc=a.g,Bd=0===y?D:D.slice(y);const m=a.I;k(nc,"peer-message",{fromId:m,fromAlias:md(nc,m),transmissionMode:b,content:Bd,contentMode:"s"})}}catch(m){T(a,m),a.g.s()?(console.error("Error handling binary update for peer '"+a.I+"', host kicking: ",
m),Q(a,"data error")):console.error("Error handling binary update for peer '"+a.I+"': ",m)}}}
async function id(a){if(8>a.byteLength)return console.warn(`Rejected binary message as too small (only ${a.byteLength} bytes)`),null;var b=new DataView(a),c=b.getUint32(0);b=b.getUint32(4);if(c!==V.Bf)return console.warn(`Rejected binary message with invalid magic number (0x${c.toString(16)})`),null;c=(b&V.ah)>>4;if(0===c)return{data:a,offset:8,flags:b};if(c>=V.Sd.length)throw Error("invalid compression type");c=V.Sd[c];a=new Blob([new Uint8Array(a,8)]);c=new DecompressionStream(c);a=a.stream().pipeThrough(c);
a=await (new Response(a)).arrayBuffer();return 0===(b&V.yf)?{data:a,offset:0,flags:b}:(new TextDecoder).decode(a)}
function nd(a,b){b=b.vc;if(!a.O&&!a.D)return 0;if(a.O&&!a.D)return a=a.O.data,0>b||b>=a.length?0:a[b];var c=Gc(a.g);let d,e,f;if(!a.O&&a.D){if(a.Ja){var g=a.Ja.timestamp;d=a.Ja.data[b];e=a.D.timestamp;f=a.D.data[b];c>a.D.timestamp+250&&(c=a.D.timestamp+250);g=g===e?0:(c-g)/(e-g);return xc(a.g.Pa[b].ib(),d,f,g,!0)}a=a.D.data;return 0>b||b>=a.length?0:a[b]}g=a.D.timestamp;d=a.D.data[b];e=a.O.timestamp;f=a.O.data[b];return xc(a.g.Pa[b].ib(),d,f,g===e?0:(c-g)/(e-g),!1)}
class V{constructor(a,b,c){this.g=a;this.I=b;this.X=0;this.ga=c;this.yb=this.L=null;this.xc=!1;this.zb=null;this.zc=!1;this.Ab=null;this.Ac=!1;this.Ph=new Nc;this.Oh=new Nc;this.Ge=this.cc=this.Cb=this.kb=!1;this.kd=this.Qf=this.Se=0;this.ve=[];this.ig=[];this.eg=this.dg=0;this.va=[];this.O=this.D=this.Ja=null;this.bg=0;this.we=!1;this.Te=1;this.rd=[];this.lg=this.sd=0;a=this.g;a.Qa.push(this);a.Aa.set(this.I,this);k(a,"add-peer",{id:this.I,alias:this.ga})}vb(a){this.X=a}s(){return this===this.g.S}ne(a){this.g.s()&&
this!==this.g.N&&Uc(this.g,"o",JSON.stringify({c:"l",i:this.I,a:this.ga,r:a}),0,this);this===this.g.N||ld(this.g,this,a)}fa(a){if(0!==this.va.length){for(;2<this.va.length&&this.va[0]!==this.Ja&&this.va[0]!==this.D&&this.va[0]!==this.O;)this.va.shift();if(!(this.O&&this.O.timestamp>a&&this.D&&this.D.timestamp<a)){this.O=null;for(let b=0,c=this.va.length;b<c;++b){const d=this.va[b];if(d.timestamp<=a){if(!this.D||d.timestamp>this.D.timestamp)this.Ja=this.D,this.D=d}else{this.O=d;break}}}}}}V.Bf=1664314736;
V.xf=1;V.yf=2;V.Wd=4;V.ah=240;V.Sd=["none","deflate","gzip"];self.Wg=V;"use strict";
const kd=self.Vg,od=self.Wg,pd=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,qd=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription,rd=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate||window.msRTCIceCandidate,sd=window.RTCDataChannel||window.webkitRTCDataChannel||window.mozRTCDataChannel||window.msRTCDataChannel,td=[{urls:"stun:stun.l.google.com:19302"}];
function ud(a){if("undefined"===typeof CompressionStream||"function"!==typeof Blob.prototype.stream)return!1;try{return new CompressionStream(a),!0}catch(b){return!1}}function fd(a){if("number"===typeof a.byteLength)return a.byteLength;if("number"===typeof a.length)return a.length;console.warn("[Construct] Multiplayer: don't know how to measure size of data: ",a);return 0}const Vc=[];ud("deflate")&&Vc.push("deflate");ud("gzip")&&Vc.push("gzip");let vd=!1;const W=[];
function Gc(a){return a.s()?performance.now()-a.Ga:performance.now()+a.ca-a.pa}function T(a,b){console.error(`[Multiplayer] Peer '${a.ga}' (${a.I}) error: `,b)}function U(a,b){a.Y&&a.$a&&a.Y.send(JSON.stringify(b))}function Zc(a){if(a.s()){do a.Tb++,65535<a.Tb&&(a.Tb=0);while(a.Id.has(a.Tb));var b=a.Tb;a.Id.add(b);return b}}function Uc(a,b,c,d=0,e=null){if(a.s()){var f=a.Qa.slice(0);for(const g of f)g&&g!==a.N&&g!==e&&R(g,b,c,d)}}function Xc(a,b){k(a,"peer-open",{id:b.I,alias:b.ga})}
function ld(a,b,c){k(a,"peer-close",{id:b.I,alias:b.ga,reason:c||"unknown"})}function ad(a,b){a.ta.Od+=fd(b)}function hd(a,b,c,d,e){if(!a.s()){a.fb=e+a.Ga;b=b+d-c;0===a.Eb.length&&(a.ca=b,a.pa=a.fb);a.Eb.push(b);30<a.Eb.length&&a.Eb.shift();W.push(...a.Eb);W.sort((f,g)=>f-g);b=0;c=W.length;4<=W.length&&6>=W.length?(++b,--c):6<W.length&&19>=W.length?(b+=2,c-=2):19<W.length&&(b+=5,c-=5);d=0;for(e=b;e<c;++e)d+=W[e];a.La=d/(c-b);W.length=0}}
function jd(a){if(a.xa){var b=Z(a.oa.yg);U(a,{message:"leave"});return b}}function Sc(a,b){k(a,"remove-peer",{id:b.I});a.s()&&a.s()&&a.Id.delete(b.X);const c=a.Qa.indexOf(b);-1<c&&a.Qa.splice(c,1);a.Aa.delete(b.I);a.S===b&&(a.S=null,wd(a,"host quit"));a.N===b&&(a.N=null,a.T="",wd(a,"disconnect"))}function xd(a,b){if(b)for(let c of b){"string"===typeof c&&(c={urls:c});a:{for(const d of a.Ke)if(d.urls===c.urls){b=!0;break a}b=!1}b||(c.hasOwnProperty("url")||(c.url=c.urls),a.Ke.push(c))}}
function wd(a,b){if(!vd){for(vd=!0;a.Qa.length;)Q(a.Qa[0],b);vd=!1}}
function yd(a,b){if(a.Y||a.$a)return Promise.resolve();const c=Z(a.oa.connect);try{a.Y=new WebSocket(b,"c2multiplayer")}catch(d){return a.Y=null,zd(a,d),c}a.Y.onopen=()=>{-1===a.Y.protocol.indexOf("c2multiplayer")?(zd(a,"server does not support 'c2multiplayer' protocol"),a.Y.close(1002,"'c2multiplayer' protocol required"),a.Y=null,a.$a=!1):a.$a=!0};a.Y.onclose=()=>{k(a,"signalling-close");a.$a=!1;a.xa=!1;a.Y=null};a.Y.onerror=d=>{console.error("Signalling server error: ",d);zd(a,d)};a.Y.onmessage=
d=>{a:{try{var e=JSON.parse(d.data)}catch(f){zd(a,f);break a}switch(e.message){case "welcome":d=e;1>d.protocolrev||1<d.protocolrev?(zd(a,"signalling server protocol revision not supported"),Ad(a)):(a.Ze=d.clientid,a.T="",e=a.Qh,e.Fg=d.protocolrev,e.version=d.version,e.name=d.name,e.operator=d.operator,e.Bg=d.motd,xd(a,d.ice_servers),k(a,"signalling-welcome",{myid:a.Ze,sigservinfo:{protocolrev:e.Fg,version:e.version,name:e.name,operator:e.operator,motd:e.Bg}}),Cd(a.oa.connect));break;case "login-ok":a.Ye=
e.alias;a.xa=!0;k(a,"signalling-login-ok",{myalias:a.Ye});Cd(a.oa.login);break;case "join-ok":d=e;wd(a,"disconnect");a.Ce=d.game;a.De=d.instance;a.T=d.room;a.N=new od(a,a.Ze,a.Ye);d.host?(a.S=a.N,a.Tb=0,a.Id.clear(),a.S.vb(Zc(a))):(a.Eb.length=0,a.La=0,a.ca=0,a.Ga=80,a.Je=30,a.Mc=30,a.fb=a.Ga,a.pa=a.Ga,a.S=new od(a,d.hostid,d.hostalias),Yc(a.S));k(a,"signalling-join-ok",{isHost:!!d.host,hostId:a.S.I,hostAlias:a.S.ga,game:a.Ce,gameInstance:a.De,room:a.T});Cd(a.oa.mf);break;case "leave-ok":a.T="";k(a,
"signalling-leave-ok");Cd(a.oa.yg);break;case "kicked":"host-left"===e.reason?Ad(a):(Dd(a),a.T="",k(a,"signalling-kicked"));break;case "peer-joined":d=e;a.xa&&a.T&&a.s()&&((e=a.Aa.get(d.peerid))&&Q(e,"rejoin"),Yc(new od(a,d.peerid,d.peeralias)));break;case "peer-quit":d=e;a.xa&&a.T&&a.s()&&(e=a.Aa.get(d.id))&&Q(e,d.reason);break;case "icecandidate":d=e;a.xa&&a.T&&(e=a.Aa.get(d.from))&&$c(e,new rd(d.icecandidate));break;case "offer":Ed(a,e);break;case "answer":Fd(a,e);break;case "instance-list":k(a,
"signalling-instance-list",{list:e.list});Cd(a.oa.zg);break;case "room-list":k(a,"signalling-room-list",{list:e.list});Cd(a.oa.Ag);break;case "error":zd(a,e.details);break;default:zd(a,"received unknown signalling message")}}};return c}function Ad(a){a.Y&&a.$a&&(a.Y.close(),a.Y=null,a.$a=!1)}function Dd(a,b){a.Eb.length=0;a.La=0;a.ca=0;wd(a,"disconnect");for(const c of a.Fa)c.gd.length=0,c.Db.clear(),c.Jc.clear(),c.bc.clear(),c.Ia.length=0;b&&jd(a)}
function Gd(a,b,c){if(!a.s()&&a.N&&a.bf&&(b=a.ed.get(b))){b=b.vc;var d=a.N.ig;d.length<b+1&&(d.length=b+1);d[b]!==c&&(d[b]=c,a.N.dg=performance.now())}}function Z(a){a.reject&&a.reject("overlapping signalling operation");return new Promise((b,c)=>{a.resolve=b;a.reject=c})}function Cd(a){a.resolve&&a.resolve(void 0);a.resolve=null;a.reject=null}
function zd(a,b){k(a,"signalling-error",{message:b?"string"===typeof b?b:"string"===typeof b.message?b.message:"string"===typeof b.details?b.details:"string"===typeof b.data?b.data:"string"===typeof b.type?b.type:"unknown error":"unknown error"});for(const c of Object.values(a.oa))c.reject&&c.reject(b),c.resolve=null,c.reject=null}
function Ed(a,b){if(a.xa&&a.T&&!a.s()&&a.N&&a.S&&a.S.L&&b.from===a.S.I){var c=a.S.L;c.setRemoteDescription(new qd(b.offer)).then(()=>{c.createAnswer().then(d=>{c.setLocalDescription(d);U(a,{message:"answer",toclientid:a.S.I,answer:d})}).catch(d=>{console.error("Peer error creating answer: ",d);T(a.N,"could not create answer to host offer")})}).catch(d=>{console.error("Peer error setting remote description: ",d);T(a.N,"could not set remote description")})}}
function Fd(a,b){a.xa&&a.T&&a.s()&&(a=a.Aa.get(b.from))&&a.L.setRemoteDescription(new qd(b.answer)).catch(c=>{console.error("Host error setting remote description: ",c)})}function md(a,b){return(a=a.Aa.get(b))?a.ga:""}
async function Hd(a,b){if(a.s()){await Id(a,b);const c=a.ye;let d=0,e=0;for(const f of a.Fa)f.gd.length&&e++;if(0!==e){c.setFloat64(d,b);d+=8;c.setUint16(d,e);d+=2;for(const f of a.Fa)if(b=f.gd,b.length){c.setUint16(d,f.X);d+=2;c.setUint16(d,b.length);d+=2;for(const g of b)c.setUint16(d,g),d+=2;b.length=0}Uc(a,"r",a.fd.slice(0,d),od.xf)}}else await Jd(a,b)}
async function Id(a,b){const c=a.ye;let d=0,e=0;const f=await aa(a,"get-object-info",{ros:a.Fa.map(g=>Ec(g))});for(const g of a.Fa){const h=g.Qc;f.hasOwnProperty(h)&&(g.fe(f[h],b),0<g.Kc&&e++)}if(0!==e){c.setFloat64(d,b);d+=8;c.setUint16(d,e);d+=2;for(const g of a.Fa)0<g.Kc&&(d=g.ge(c,d,b));Uc(a,"u",a.fd.slice(0,d),0)}}
async function Jd(a,b){a.T&&(a.s()||0!==a.La)&&await Kd(a);if(a.N&&a.bf){var c=a.ye,d=0,e=a.Pa,f=a.N.ig,g=b-a.N.dg,h=b-a.N.eg;if(100>g||(1E3>g?95<=h:495<=h)){c.setFloat64(d,b+a.ca);d+=8;c.setUint8(d,e.length);d+=1;for(let l=0,v=e.length;l<v;++l)g=e[l],h=0,l<f.length&&(h=uc(g,f[l])),d=vc(g,c,d,h);a.N.eg=b;R(a.S,"u",a.fd.slice(0,d))}}}async function Kd(a){const b=await aa(a,"before-client-update");for(const c of b.clientStateUpdates)Gd(a,c.tag,c.value)}
self.Ea.hb(class extends self.qb{constructor(a){super(a,"multiplayer");this.Ke=[];this.Y=null;this.xa=this.$a=!1;this.Qh={Fg:0,version:0,name:"",operator:"",Bg:""};this.T=this.De=this.Ce=this.Ye=this.Ze="";this.Qa=[];this.Aa=new Map;this.Tb=0;this.Id=new Set;this.S=this.N=null;this.Ga=80;this.Mc=this.Je=30;this.gg=0;this.ta={Uc:0,Eg:0,pf:0,Cg:0,Dg:0,Nd:0,Od:0,xg:0,lf:0,vg:0,wg:0,Md:0,ec:0};this.fd=new ArrayBuffer(262144);this.ye=new DataView(this.fd);this.Fa=[];this.Lh=1;this.Zb=new Map;this.Oc=new Map;
this.df=this.ef=this.cf=0;this.Eb=[];this.ca=this.La=0;this.pa=this.fb=this.Ga;this.Pa=[];this.ed=new Map;this.bf=!1;this.oa={connect:{resolve:null,reject:null},login:{resolve:null,reject:null},mf:{resolve:null,reject:null},yg:{resolve:null,reject:null},zg:{resolve:null,reject:null},Ag:{resolve:null,reject:null}};xd(this,td);setInterval(()=>{const b=performance.now();if(this.s()){W.push(...this.Qa);for(const c of W)c&&c!==this.N&&Wc(c,b,!1);W.length=0}else this.S&&Wc(this.S,b,!1)},2E3);window.addEventListener("unload",
()=>wd(this,"quit"));n(this,"get-supported",()=>({isSupported:!(!pd||!sd)}));n(this,"add-ice-servers",b=>xd(this,b.list));n(this,"simulate-latency",b=>{var c=b.pdv,d=b.loss;this.cf=Math.max(b.latency,0);this.ef=Math.max(c,0);this.df=Math.max(d,0)});n(this,"set-bandwidth-profile",b=>{var c=b.updateRate;b=b.delay;this.T||(this.Mc=this.Je=c,this.Ga=b)});n(this,"tick",b=>this.fa(b));n(this,"alert",b=>{alert(b.message)});n(this,"signalling-connect",b=>yd(this,b.url));n(this,"signalling-disconnect",()=>
Ad(this));n(this,"signalling-login",b=>{b=b.alias;if(this.xa)b=void 0;else{var c=Z(this.oa.login);U(this,{message:"login",protocolrev:1,datachannelrev:2,compressionformats:Vc,alias:b});b=c}return b});n(this,"signalling-join-room",b=>{var c=b.game;var d=b.instance,e=b.room;b=b.maxClients;if(this.xa&&!this.T){var f=Z(this.oa.mf);U(this,{message:"join",game:c,instance:d,room:e,max_clients:b});c=f}else c=void 0;return c});n(this,"signalling-auto-join-room",b=>{var c=b.game;var d=b.instance,e=b.room,f=
b.maxClients;b=b.lock;if(this.xa&&!this.T){var g=Z(this.oa.mf);U(this,{message:"auto-join",game:c,instance:d,room:e,max_clients:f,lock_when_full:b});c=g}else c=void 0;return c});n(this,"signalling-leave-room",()=>jd(this));n(this,"signalling-list-game-instances",b=>{b=b.game;if(this.Y&&this.$a){var c=Z(this.oa.zg);U(this,{message:"list-instances",game:b});b=c}else b=void 0;return b});n(this,"signalling-list-rooms",b=>{var c=b.game;var d=b.instance;b=b.which;if(this.Y&&this.$a){var e=Z(this.oa.Ag);
U(this,{message:"list-rooms",game:c,instance:d,which:b});c=e}else c=void 0;return c});n(this,"disconnect-room",()=>Dd(this,!0));n(this,"peer-send-message",b=>{const c=b.tag;var d=b.message;const e=b.transmissionMode,f=b.contentMode;if(b=this.Aa.get(b.id)||null)"s"===f&&d instanceof ArrayBuffer?R(b,e,d,od.Wd):(d={c:"m",cm:f,m:d},"e"===f&&(d.t=c),R(b,e,JSON.stringify(d)))});n(this,"host-broadcast",b=>{var c=b.fromId;const d=b.tag,e=b.message,f=b.transmissionMode;b=b.contentMode;const g=this.Aa.get(c)||
null;"s"===b&&e instanceof ArrayBuffer?Uc(this,f,e,od.Wd,g):(c={c:"m",cm:b,f:c,m:e},"e"===b&&(c.t=d),Uc(this,f,JSON.stringify(c),0,g))});n(this,"kick-peer",b=>{if(this.s()){var c=b.reason;(b=this.Aa.get(b.id)||null)&&Q(b,c,!0)}});n(this,"sync-object",b=>{const c=b.x,d=b.y,e=b.angle,f=b.precision,g=b.bandwidth;for(const h of b.objectClasses)b=new self.Xg(this,h.roId,h.sid,g),c&&Bc(b,1,f,"x"),d&&Bc(b,1,f,"y"),e&&Bc(b,2,f,"a")});n(this,"sync-inst-var",b=>{const c=b.precision,d=b.interp,e=b.cvt;for(const f of b.syncData)Bc(this.Oc.get(f.roId),
d,c,"iv",f.varIndex,e)});n(this,"associate-object",b=>{var c=b.peerId;const d=b.instUid;b=this.Oc.get(b.roId);c=this.Aa.get(c);if(b&&c&&this.s())if(c=c.X,b.Db.has(d))console.warn("OverrideNid passed id "+d+" which is already in use and cannot be overridden");else if(b.bc.has(c))console.warn("OverrideNid passed nid "+c+" which is already in use and cannot be overridden");else{var e=new Ac(b,d,c);b.Db.set(d,e);b.bc.add(c);b.Ia.push(e);b.Pb=!0}});n(this,"remove-object-id",b=>this.be(b.uid));n(this,"remove-net-insts",
b=>{for(const [c,d]of Object.entries(b))if(b=this.Oc.get(parseInt(c,10)))for(const e of d)Dc(b,e)});n(this,"remove-object-nid",b=>{const c=b.nid;(b=this.Oc.get(b.roId))&&Dc(b,c)});n(this,"set-client-state",b=>Gd(this,b.tag,b.value));n(this,"add-client-input-value",b=>{var c=b.tag;b=new kd(this.Pa.length,b.interp,b.precision,c,null);this.ed.set(c,b);this.Pa.push(b)})}s(){return!!this.T&&this.N&&this.S===this.N}fa(a){if(!this.T)return null;a=a.dt;var b=performance.now();b-this.gg>=1E3/(this.s()?this.Je:
this.Mc)-5&&(Hd(this,b),this.gg=b);var c=this.ta;1E3<=b-c.Uc&&(c.Eg=c.pf,c.Cg=c.Nd,c.Dg=c.Od,c.xg=c.lf,c.vg=c.Md,c.wg=c.ec,c.pf=0,c.Nd=0,c.Od=0,c.lf=0,c.Md=0,c.ec=0,c.Uc+=1E3,500<b-c.Uc&&(c.Uc=b),k(this,"stats",{stats:{outboundPerSec:c.Eg,outboundBandwidthPerSec:c.Cg,outboundDecompressedBandwidthPerSec:c.Dg,inboundPerSec:c.xg,inboundBandwidthPerSec:c.vg,inboundDecompressedBandwidthPerSec:c.wg}}));this.s()||(this.ca<this.La?(this.ca+=10*a,this.ca>this.La&&(this.ca=this.La)):this.ca>this.La&&(this.ca-=
10*a,this.ca<this.La&&(this.ca=this.La)),this.pa<this.fb?(this.pa+=30*a,this.pa>this.fb&&(this.pa=this.fb)):this.pa>this.fb&&(this.pa-=30*a,this.pa<this.fb&&(this.pa=this.fb)));a=Gc(this);for(var d of this.Qa)d.fa(a);for(var e of this.Fa)e.fa();d=Gc(this);e=this.s()?performance.now():performance.now()+this.ca+this.pa;a=this.Ga;b={};for(var f of this.Qa){c={};for(const g of this.Pa)c[g.eb]=nd(f,g);b[f.I]={nid:f.X,latency:f.sd,pdv:f.lg,clientState:c}}f={};for(const g of this.Fa)f[g.Qc]=g.Jb();return{simulationTime:d,
hostInputArrivalTime:e,clientDelay:a,peerData:b,roData:f,isReadyForInput:this.T?this.s()?!0:0!==this.La:!1}}be(a){for(const b of this.Fa)b.be(a)}});"use strict";let Ld=!1;async function Md(a){var b=Nd(a.index);if(b&&(b=b.vibrationActuator)&&b.playEffect)try{await b.playEffect("dual-rumble",{duration:a.duration,startDelay:0,weakMagnitude:a.weakMag,strongMagnitude:a.strongMag})}catch(c){console.warn("[Gamepad] Failed to vibrate gamepad: ",c)}}
function Od(){try{return Array.from(navigator.getGamepads()).filter(a=>a&&a.connected)}catch(a){return Ld||(console.warn("[Construct] Failed to access gamepads: ",a),Ld=!0),[]}}function Nd(a){for(const b of Od())if(b.index===a)return b;return null}
self.Ea.hb(class extends self.qb{constructor(a){super(a,"gamepad");this.$f=!!navigator.getGamepads;this.Pe=!1;n(this,"is-supported",()=>this.$f);n(this,"ready",()=>{this.Pe=!0;for(const b of Od())k(this,"gamepad-connected",{index:b.index,id:b.id});this.$f&&da(this)});n(this,"vibrate",b=>Md(b));n(this,"reset-vibrate",b=>{(b=Nd(b.index))&&(b=b.vibrationActuator)&&b.reset&&b.reset()});window.addEventListener("gamepadconnected",b=>{this.Pe&&(b=b.gamepad,k(this,"gamepad-connected",{index:b.index,id:b.id}))});
window.addEventListener("gamepaddisconnected",b=>{this.Pe&&k(this,"gamepad-disconnected",{index:b.gamepad.index})});window.addEventListener("unload",()=>{for(const b of Od()){const c=b.vibrationActuator;c&&c.reset&&c.reset()}})}fa(){var a=Od();a.length&&(a=a.map(b=>({index:b.index,id:b.id,buttons:b.buttons.map(c=>({pressed:c.pressed,value:c.value})),axes:b.axes})),k(this,"input-update",a))}});
